<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Admin Dashboard | ICMMCS 2025</title>
	<meta name="description" content="Admin dashboard for managing the ICMMCS 2025 conference.">
	<meta property="og:image" content="../assets/img/sponsors_logo/3.png" />
	<meta property="og:title" content="Admin Dashboard | ICMMCS 2025" />
	<meta property="og:description" content="Admin dashboard for managing the ICMMCS 2025 conference." />
	<meta property="og:url" content="https://www.icmmcs.org/admin/adminDashboard.html" />

	<!--=====FAB ICON=======-->
	<link rel="shortcut icon" href="../assets/img/sponsors_logo/favicon.png" />

	<!--===== CSS LINK =======-->
	<link href="../assets/css/vendor/bootstrap.min.css" rel="stylesheet">
	<link href="../assets/css/vendor/fontawesome.css" rel="stylesheet">
	<link href="../assets/css/vendor/dataTables.bootstrap5.min.css" rel="stylesheet">

	<style>
		body {
			background-color: #f8f9fa;
		}

		.sidebar {
			min-height: 100vh;
			background: linear-gradient(180deg, #019087 0%, #006666 100%);
			color: white;
			position: fixed;
			top: 0;
			left: 0;
			width: 250px;
			z-index: 1000;
			transition: all 0.3s;
		}

		.sidebar.collapsed {
			margin-left: -250px;
		}

		.main-content {
			margin-left: 250px;
			transition: all 0.3s;
		}

		.main-content.expanded {
			margin-left: 0;
		}

		.navbar {
			background-color: white;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.sidebar .nav-link {
			color: rgba(255,255,255,0.8);
			border-radius: 5px;
			margin: 2px 0;
		}

		.sidebar .nav-link:hover, .sidebar .nav-link.active {
			background-color: rgba(255,255,255,0.1);
			color: white;
		}

		.card {
			border: none;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
			border-radius: 10px;
		}

		.stats-card {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border-radius: 15px;
		}

		.stats-card.registrations {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		}

		.stats-card.speakers {
			background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
		}

		.stats-card.sponsors {
			background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
		}

		.stats-card.admins {
			background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
		}

		.table thead th {
			background-color: #019087;
			color: white;
			border: none;
		}

		.btn-primary {
			background-color: #019087;
			border-color: #019087;
		}

		.btn-primary:hover {
			background-color: #006666;
			border-color: #006666;
		}

		.content-section {
			display: none;
		}

		.content-section.active {
			display: block;
		}

		.sidebar-brand {
			padding: 1rem;
			text-align: center;
			border-bottom: 1px solid rgba(255,255,255,0.2);
		}

		.toggle-btn {
			position: fixed;
			top: 10px;
			left: 10px;
			z-index: 1001;
		}

		@media (max-width: 768px) {
			.sidebar {
				margin-left: -250px;
			}
			.main-content {
				margin-left: 0;
			}
			.sidebar.show {
				margin-left: 0;
			}
		}

		.modal-backdrop {
			z-index: 1040;
		}

		.modal {
			z-index: 1050;
		}

		/* DataTable Responsive Improvements */
		.dataTables_wrapper {
			overflow-x: auto;
		}

		.dataTables_wrapper .dataTables_scroll {
			overflow-x: auto;
		}

		.dataTables_wrapper .dataTables_scrollBody {
			overflow-x: auto;
			overflow-y: auto;
		}

		/* Mobile responsive table */
		@media (max-width: 768px) {
			.table-responsive {
				font-size: 0.85rem;
			}
			
			.btn-group .btn {
				padding: 0.25rem 0.5rem;
				font-size: 0.75rem;
			}
			
			.dataTables_wrapper .dataTables_length,
			.dataTables_wrapper .dataTables_filter,
			.dataTables_wrapper .dataTables_info,
			.dataTables_wrapper .dataTables_paginate {
				font-size: 0.85rem;
			}
		}

		/* Improve table cell content */
		.table td {
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			max-width: 200px;
		}

		.table td.text-wrap {
			white-space: normal;
		}

		/* Better button group spacing */
		.btn-group .btn {
			margin: 0 1px;
		}

		/* Responsive priority classes */
		@media (max-width: 576px) {
			.d-sm-none { display: none !important; }
		}

		@media (max-width: 768px) {
			.d-md-none { display: none !important; }
		}

		@media (max-width: 992px) {
			.d-lg-none { display: none !important; }
		}

		@media (max-width: 1200px) {
			.d-xl-none { display: none !important; }
		}
	</style>
</head>

<body>
	<!-- Toggle Button -->
	<button class="btn btn-primary toggle-btn d-md-none" onclick="toggleSidebar()">
		<i class="fas fa-bars"></i>
	</button>

	<!-- Sidebar -->
	<nav class="sidebar" id="sidebar">
		<div class="sidebar-brand">
			<h4>ICMMCS Admin</h4>
			<p class="mb-0">Dashboard</p>
		</div>
		<ul class="nav flex-column p-3">
			<li class="nav-item">
				<a class="nav-link active" href="#" onclick="showSection('dashboard')">
					<i class="fas fa-tachometer-alt me-2"></i> Dashboard
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('registrations')">
					<i class="fas fa-users me-2"></i> Registrations
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('speakers')">
					<i class="fas fa-microphone me-2"></i> Presenters
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('keynote-speakers')">
					<i class="fas fa-star me-2"></i> Keynote Speakers
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('sponsors')">
					<i class="fas fa-handshake me-2"></i> Sponsors
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('referrals')">
					<i class="fas fa-link me-2"></i> My Referrals
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('contacts')">
					<i class="fas fa-envelope me-2"></i> Contact Queries
				</a>
			</li>
			<li class="nav-item mt-3">
				<a class="nav-link text-warning" href="#" onclick="logout()">
					<i class="fas fa-sign-out-alt me-2"></i> Logout
				</a>
			</li>
		</ul>
	</nav>

	<!-- Main Content -->
	<div class="main-content" id="mainContent">
		<!-- Top Navbar -->
		<nav class="navbar navbar-expand-lg">
			<div class="container-fluid">
				<button class="btn btn-outline-primary d-none d-md-block" onclick="toggleSidebar()">
					<i class="fas fa-bars"></i>
				</button>
				<span class="navbar-text ms-3">
					Welcome, <span id="adminEmail">Admin</span>
				</span>
				<div class="ms-auto">
					<span class="badge bg-primary me-2" id="referralCodeDisplay">Loading...</span>
				</div>
			</div>
		</nav>

		<!-- Dashboard Content -->
		<div class="container-fluid p-4">
			<!-- Dashboard Section -->
			<div id="dashboard" class="content-section active">
				<h2 class="mb-4">Dashboard Overview</h2>
				
				<!-- Stats Cards -->
				<div class="row mb-4">
					<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
						<div class="card stats-card registrations">
							<div class="card-body text-center">
								<i class="fas fa-users fa-2x mb-2"></i>
								<h3 id="registrationsCount">0</h3>
								<p class="mb-0">Total Registrations</p>
							</div>
						</div>
					</div>
					<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
						<div class="card stats-card speakers">
							<div class="card-body text-center">
								<i class="fas fa-microphone fa-2x mb-2"></i>
								<h3 id="speakersCount">0</h3>
								<p class="mb-0">Total Presenters</p>
							</div>
						</div>
					</div>
					<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
						<div class="card stats-card keynote-speakers" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
							<div class="card-body text-center">
								<i class="fas fa-star fa-2x mb-2"></i>
								<h3 id="keynoteSpeakersCount">0</h3>
								<p class="mb-0">Keynote Speakers</p>
							</div>
						</div>
					</div>
					<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
						<div class="card stats-card sponsors">
							<div class="card-body text-center">
								<i class="fas fa-handshake fa-2x mb-2"></i>
								<h3 id="sponsorsCount">0</h3>
								<p class="mb-0">Total Sponsors</p>
							</div>
						</div>
					</div>
					<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
						<div class="card stats-card admins">
							<div class="card-body text-center">
								<i class="fas fa-user-shield fa-2x mb-2"></i>
								<h3 id="adminsCount">0</h3>
								<p class="mb-0">Total Admins</p>
							</div>
						</div>
					</div>
				</div>

				<!-- Recent Registrations -->
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">Recent Registrations</h5>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-hover">
								<thead>
									<tr>
										<th>Name</th>
										<th>Email</th>
										<th>Registration Date</th>
										<th>Fee</th>
									</tr>
								</thead>
								<tbody id="recentRegistrationsTable">
									<tr>
										<td colspan="4" class="text-center">Loading...</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Registrations Section -->
			<div id="registrations" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Conference Registrations</h2>
					<button class="btn btn-success" onclick="exportData('registrations')">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="registrationsTable" class="table table-striped table-hover" style="width: 100%;">
								<thead>
									<tr>
										<th style="min-width: 60px;">ID</th>
										<th style="min-width: 150px;">Name</th>
										<th style="min-width: 180px;">Email</th>
										<th style="min-width: 120px;">Phone</th>
										<th style="min-width: 100px;">Country</th>
										<th style="min-width: 150px;">Institution</th>
										<th style="min-width: 120px;">Type</th>
										<th style="min-width: 100px;">Fee</th>
										<th style="min-width: 100px;">Paid</th>
										<th style="min-width: 120px;">Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Speakers Section -->
			<div id="speakers" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Paper Submissions</h2>
					<div>
						<button class="btn btn-info me-2" onclick="showSpeakerStats()">
							<i class="fas fa-chart-bar me-2"></i>Statistics
						</button>
						<button class="btn btn-success" onclick="exportData('speakers')">
							<i class="fas fa-download me-2"></i>Export
						</button>
					</div>
				</div>
				
				<!-- Statistics Cards -->
				<div class="row mb-4" id="speakerStatsCards" style="display: none;">
					<div class="col-md-2">
						<div class="card bg-primary text-white">
							<div class="card-body text-center">
								<h4 id="totalPapers">0</h4>
								<small>Total Papers</small>
							</div>
						</div>
					</div>
					<div class="col-md-2">
						<div class="card bg-warning text-white">
							<div class="card-body text-center">
								<h4 id="pendingPapers">0</h4>
								<small>Pending</small>
							</div>
						</div>
					</div>
					<div class="col-md-2">
						<div class="card bg-info text-white">
							<div class="card-body text-center">
								<h4 id="underReviewPapers">0</h4>
								<small>Under Review</small>
							</div>
						</div>
					</div>
					<div class="col-md-2">
						<div class="card bg-success text-white">
							<div class="card-body text-center">
								<h4 id="approvedPapers">0</h4>
								<small>Approved</small>
							</div>
						</div>
					</div>
					<div class="col-md-2">
						<div class="card bg-danger text-white">
							<div class="card-body text-center">
								<h4 id="rejectedPapers">0</h4>
								<small>Rejected</small>
							</div>
						</div>
					</div>
					<div class="col-md-2">
						<div class="card bg-secondary text-white">
							<div class="card-body text-center">
								<h4 id="needsRevisionPapers">0</h4>
								<small>Needs Revision</small>
							</div>
						</div>
					</div>
				</div>
				
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="speakersTable" class="table table-striped table-hover" style="width: 100%;">
								<thead>
									<tr>
										<th style="min-width: 80px;">Files</th>
										<th style="min-width: 120px;">Author</th>
										<th style="min-width: 150px;">Email</th>
										<th style="min-width: 150px;">Institution</th>
										<th style="min-width: 200px;">Paper Title</th>
										<th style="min-width: 120px;">Subject Area</th>
										<th style="min-width: 100px;">Country</th>
										<th style="min-width: 130px;">Review Status</th>
										<th style="min-width: 150px;">Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Keynote Speakers Section -->
			<div id="keynote-speakers" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Conference Keynote Speakers</h2>
					<button class="btn btn-success" onclick="exportData('keynote-speakers')">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="keynoteSpeakersTable" class="table table-striped table-hover" style="width: 100%;">
								<thead>
									<tr>
										<th style="min-width: 150px;">Name</th>
										<th style="min-width: 180px;">Email</th>
										<th style="min-width: 150px;">Institution</th>
										<th style="min-width: 200px;">Keynote Title</th>
										<th style="min-width: 150px;">Expertise Area</th>
										<th style="min-width: 100px;">Status</th>
										<th style="min-width: 120px;">Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Sponsors Section -->
			<div id="sponsors" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Conference Sponsors</h2>
					<button class="btn btn-success" onclick="exportData('sponsors')">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="sponsorsTable" class="table table-striped table-hover">
								<thead>
									<tr>
										<th>ID</th>
										<th>Name</th>
										<th>Email</th>
										<th>Level</th>
										<th>Amount</th>
										<th>Paid</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Referrals Section -->
			<div id="referrals" class="content-section">
				<h2 class="mb-4">My Referrals</h2>
				<div class="row mb-4">
					<div class="col-md-6">
						<div class="card">
							<div class="card-header">
								<h5 class="mb-0">Your Referral Code</h5>
							</div>
							<div class="card-body">
								<div class="input-group">
									<input type="text" class="form-control" id="referralCodeInput" readonly>
									<button class="btn btn-primary" onclick="copyReferralCode()">
										<i class="fas fa-copy"></i> Copy
									</button>
								</div>
								<small class="text-muted">Share this code with potential registrants</small>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card">
							<div class="card-header">
								<h5 class="mb-0">Referral Links</h5>
							</div>
							<div class="card-body">
								<div class="mb-2">
									<label class="form-label">Conference Registration:</label>
									<div class="input-group input-group-sm">
										<input type="text" class="form-control" id="confReferralLink" readonly>
										<button class="btn btn-outline-primary btn-sm" onclick="copyLink('confReferralLink')">
											<i class="fas fa-copy"></i>
										</button>
									</div>
								</div>
								<div>
									<label class="form-label">Speaker Registration:</label>
									<div class="input-group input-group-sm">
										<input type="text" class="form-control" id="speakerReferralLink" readonly>
										<button class="btn btn-outline-primary btn-sm" onclick="copyLink('speakerReferralLink')">
											<i class="fas fa-copy"></i>
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">Referred Users</h5>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table id="referredUsersTable" class="table table-striped">
								<thead>
									<tr>
										<th>Name</th>
										<th>Email</th>
										<th>Registration Date</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Contact Queries Section -->
			<div id="contacts" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Contact Form Submissions</h2>
					<button class="btn btn-success" onclick="exportData('contacts')">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="contactsTable" class="table table-striped table-hover" style="width: 100%;">
								<thead>
									<tr>
										<th style="min-width: 120px;">Name</th>
										<th style="min-width: 180px;">Email</th>
										<th style="min-width: 120px;">Phone</th>
										<th style="min-width: 200px;">Subject</th>
										<th style="min-width: 300px;">Message</th>
										<th style="min-width: 120px;">Date</th>
										<th style="min-width: 100px;">Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Edit Modal -->
	<div class="modal fade" id="editModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="editModalTitle">Edit Record</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" id="editModalBody">
					<!-- Dynamic content will be loaded here -->
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Keynote Speaker Details Modal -->
	<div class="modal fade" id="keynoteSpeakerDetailsModal" tabindex="-1">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title"><i class="fas fa-star me-2"></i>Keynote Speaker Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" id="keynoteSpeakerDetailsContent">
					<!-- Keynote speaker details will be loaded here -->
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="button" class="btn btn-success" id="updateStatusBtn" onclick="showStatusUpdateModal()">
						<i class="fas fa-edit me-2"></i>Update Status
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Status Update Modal -->
	<div class="modal fade" id="statusUpdateModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title"><i class="fas fa-clipboard-check me-2"></i>Update Keynote Speaker Status</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<form id="statusUpdateForm">
						<input type="hidden" id="statusUpdateSpeakerId">
						<div class="mb-3">
							<label for="newStatus" class="form-label">Select New Status</label>
							<select class="form-control" id="newStatus" required>
								<option value="">Choose Status</option>
								<option value="PENDING">Pending Review</option>
								<option value="UNDER_REVIEW">Under Review</option>
								<option value="APPROVED">Approved</option>
								<option value="REJECTED">Rejected</option>
								<option value="CONFIRMED">Confirmed</option>
							</select>
						</div>
						<div class="mb-3">
							<label for="statusNotes" class="form-label">Notes (Optional)</label>
							<textarea class="form-control" id="statusNotes" rows="3" placeholder="Add any notes about this status change..."></textarea>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" onclick="updateKeynoteSpeakerStatus()">
						<i class="fas fa-save me-2"></i>Update Status
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Send to Committee Modal -->
	<div class="modal fade" id="sendToCommitteeModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title"><i class="fas fa-users-cog me-2"></i>Send Speaker to Reviewing Committee</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<input type="hidden" id="sendToCommitteeSpeakerId">
					
					<div class="alert alert-info">
						<i class="fas fa-info-circle me-2"></i>
						<strong>Speaker:</strong> <span id="speakerNameDisplay"></span><br>
						<strong>Paper Title:</strong> <span id="paperTitleDisplay"></span>
					</div>

					<div class="mb-3">
						<label class="form-label">Select Committee Members</label>
						<div class="form-check mb-2">
							<input class="form-check-input" type="checkbox" id="sendToAllCommittee">
							<label class="form-check-label" for="sendToAllCommittee">
								<strong>Send to All Active Committee Members</strong>
							</label>
						</div>
					</div>

					<div id="committeeSelectContainer">
						<label class="form-label">Or select specific members:</label>
						<div id="committeeCheckboxes">
							<!-- Committee member checkboxes will be loaded here -->
						</div>
					</div>

					<div class="mt-3">
						<small class="text-muted">
							<i class="fas fa-envelope me-1"></i>
							Selected committee members will receive an email with the speaker's complete details for review.
						</small>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-success" onclick="sendSpeakerToCommittee()">
						<i class="fas fa-paper-plane me-2"></i>Send for Review
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Update Speaker Review Status Modal -->
	<div class="modal fade" id="updateSpeakerStatusModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title"><i class="fas fa-clipboard-check me-2"></i>Update Speaker Review Status</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<form id="updateSpeakerStatusForm">
						<input type="hidden" id="updateStatusSpeakerId">
						<div class="mb-3">
							<label for="speakerReviewStatus" class="form-label">Review Status</label>
							<select class="form-control" id="speakerReviewStatus" required>
								<option value="">Choose Status</option>
								<option value="PENDING">Pending</option>
								<option value="SENT_TO_COMMITTEE">Sent to Committee</option>
								<option value="UNDER_REVIEW">Under Review</option>
								<option value="APPROVED">Approved</option>
								<option value="REJECTED">Rejected</option>
								<option value="NEEDS_REVISION">Needs Revision</option>
							</select>
						</div>
						<div class="mb-3">
							<label for="speakerStatusNotes" class="form-label">Notes (Optional)</label>
							<textarea class="form-control" id="speakerStatusNotes" rows="3" placeholder="Add any notes about this status change..."></textarea>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" onclick="updateSpeakerReviewStatus()">
						<i class="fas fa-save me-2"></i>Update Status
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Paper Submission Details Modal -->
	<div class="modal fade" id="paperSubmissionDetailsModal" tabindex="-1">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title"><i class="fas fa-file-alt me-2"></i>Paper Submission Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" id="paperSubmissionDetailsContent">
					<!-- Paper submission details will be loaded here -->
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<!-- <button type="button" class="btn btn-success" onclick="showUpdateSpeakerStatusModal()">
						<i class="fas fa-edit me-2"></i>Update Status
					</button> -->
				</div>
			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script src="../assets/js/vendor/jquery-3.7.1.min.js"></script>
	<script src="../assets/js/vendor/bootstrap.min.js"></script>
	<script src="../assets/js/vendor/jquery.dataTables.min.js"></script>
	<script src="../assets/js/vendor/dataTables.bootstrap5.min.js"></script>

	<script>
		let currentEditId = null;
		let currentEditType = null;
		let committeeMembers = [];
		const API_BASE_URL = 'https://icmmcs-backend-production.up.railway.app/api';
		// const API_BASE_URL = 'http://localhost:5000/api';

		// Helper function to get review status badge
		function getReviewStatusBadge(status) {
			const statusClasses = {
				'PENDING': 'bg-warning',
				'SENT_TO_COMMITTEE': 'bg-info',
				'UNDER_REVIEW': 'bg-primary',
				'APPROVED': 'bg-success',
				'REJECTED': 'bg-danger',
				'NEEDS_REVISION': 'bg-warning'
			};
			const statusText = {
				'PENDING': 'Pending',
				'SENT_TO_COMMITTEE': 'Sent to Committee',
				'UNDER_REVIEW': 'Under Review',
				'APPROVED': 'Approved',
				'REJECTED': 'Rejected',
				'NEEDS_REVISION': 'Needs Revision'
			};
			return `<span class="badge ${statusClasses[status] || 'bg-secondary'}">${statusText[status] || status}</span>`;
		}

		// Helper function to check if speaker can be sent to committee
		function canSendSpeakerToCommittee(speaker) {
			return (speaker.sentToCommittee === false || speaker.sentToCommittee === null || speaker.sentToCommittee === undefined) && 
				   speaker.reviewStatus === 'PENDING';
		}

		// Load committee members for dropdown
		async function loadCommitteeMembers() {
			try {
				const token = localStorage.getItem('adminToken');
				const response = await fetch(`${API_BASE_URL}/reviewing-committee/active-members`, {
					headers: {
						'Authorization': `Bearer ${token}`
					}
				});
				
				if (response.ok) {
					const result = await response.json();
					committeeMembers = result.data;
				}
			} catch (error) {
				console.error('Error loading committee members:', error);
			}
		}

		// Show send to committee modal
		async function showSendToCommitteeModal(speakerId) {
			// Find the speaker
			const speaker = currentSpeakers.find(s => s.id === speakerId);
			if (!speaker) return;

			// Load committee members if not already loaded
			if (committeeMembers.length === 0) {
				await loadCommitteeMembers();
			}

			document.getElementById('sendToCommitteeSpeakerId').value = speakerId;
			document.getElementById('speakerNameDisplay').textContent = speaker.name;
			document.getElementById('paperTitleDisplay').textContent = speaker.paperTitle;

			// Populate committee checkboxes
			const checkboxContainer = document.getElementById('committeeCheckboxes');
			checkboxContainer.innerHTML = '';

			if (committeeMembers.length === 0) {
				checkboxContainer.innerHTML = '<p class="text-muted">No active committee members found. Please contact super admin to add committee members.</p>';
			} else {
				committeeMembers.forEach(member => {
					checkboxContainer.innerHTML += `
						<div class="form-check mb-2">
							<input class="form-check-input committee-member-check" type="checkbox" value="${member.id}" id="member_${member.id}">
							<label class="form-check-label" for="member_${member.id}">
								<strong>${member.name}</strong> - ${member.designation}<br>
								<small class="text-muted">${member.institution} | ${member.expertise}</small>
							</label>
						</div>
					`;
				});
			}

			// Handle "send to all" checkbox
			document.getElementById('sendToAllCommittee').addEventListener('change', function() {
				const memberChecks = document.querySelectorAll('.committee-member-check');
				const container = document.getElementById('committeeSelectContainer');
				
				if (this.checked) {
					container.style.display = 'none';
				} else {
					container.style.display = 'block';
				}
			});

			new bootstrap.Modal(document.getElementById('sendToCommitteeModal')).show();
		}

		// Send speaker to committee
		async function sendSpeakerToCommittee() {
			const speakerId = document.getElementById('sendToCommitteeSpeakerId').value;
			const sendToAll = document.getElementById('sendToAllCommittee').checked;
			
			let committeeIds = [];
			if (!sendToAll) {
				const checkedBoxes = document.querySelectorAll('.committee-member-check:checked');
				committeeIds = Array.from(checkedBoxes).map(cb => cb.value);
				
				if (committeeIds.length === 0) {
					alert('Please select at least one committee member or choose "Send to All"');
					return;
				}
			}

			try {
				const token = localStorage.getItem('adminToken');
				const response = await fetch(`${API_BASE_URL}/reviewing-committee/send-speaker/${speakerId}`, {
					method: 'POST',
					headers: {
						'Authorization': `Bearer ${token}`,
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({
						committeeIds: sendToAll ? [] : committeeIds,
						sendToAll: sendToAll
					})
				});

				const result = await response.json();
				if (response.ok) {
					alert(result.message);
					bootstrap.Modal.getInstance(document.getElementById('sendToCommitteeModal')).hide();
					loadSpeakers(); // Reload speakers to update status
				} else {
					throw new Error(result.message || 'Failed to send speaker to committee');
				}
			} catch (error) {
				console.error('Error sending speaker to committee:', error);
				alert('Error: ' + error.message);
			}
		}

		// Show update speaker status modal
		function showUpdateSpeakerStatusModal(speakerId) {
			const speaker = currentSpeakers.find(s => s.id === speakerId);
			if (!speaker) {
				console.error('Speaker not found:', speakerId);
				return;
			}

			document.getElementById('updateStatusSpeakerId').value = speakerId;
			document.getElementById('speakerReviewStatus').value = speaker.reviewStatus || 'PENDING';
			document.getElementById('speakerStatusNotes').value = '';

			new bootstrap.Modal(document.getElementById('updateSpeakerStatusModal')).show();
		}

		// Update speaker review status
		async function updateSpeakerReviewStatus() {
			const speakerId = document.getElementById('updateStatusSpeakerId').value;
			const reviewStatus = document.getElementById('speakerReviewStatus').value;
			const notes = document.getElementById('speakerStatusNotes').value;

			if (!reviewStatus) {
				alert('Please select a review status');
				return;
			}

			if (!speakerId) {
				alert('Speaker ID not found');
				return;
			}

			try {
				const token = localStorage.getItem('adminToken');
				const response = await fetch(`${API_BASE_URL}/reviewing-committee/speaker-status/${speakerId}`, {
					method: 'PUT',
					headers: {
						'Authorization': `Bearer ${token}`,
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({
						reviewStatus: reviewStatus,
						notes: notes
					})
				});

				const result = await response.json();
				if (response.ok) {
					alert('Speaker review status updated successfully');
					bootstrap.Modal.getInstance(document.getElementById('updateSpeakerStatusModal')).hide();
					loadSpeakers(); // Reload speakers to update status
				} else {
					throw new Error(result.message || 'Failed to update speaker status');
				}
			} catch (error) {
				console.error('Error updating speaker status:', error);
				alert('Error: ' + error.message);
			}
		}

		// Store current speakers for reference
		let currentSpeakers = [];

		// Show paper submission details
		async function showPaperSubmissionDetails(speakerId) {
			try {
				const token = localStorage.getItem('adminToken');
				const response = await fetch(`${API_BASE_URL}/admin/speakers/${speakerId}`, {
					headers: {
						'Authorization': `Bearer ${token}`
					}
				});

				if (!response.ok) {
					throw new Error('Failed to fetch speaker details');
				}

				const result = await response.json();
				const speaker = result;

				// Parse co-authors if they exist
				let coAuthors = [];
				if (speaker.coAuthors) {
					try {
						coAuthors = JSON.parse(speaker.coAuthors);
					} catch (e) {
						console.error('Error parsing co-authors:', e);
					}
				}

				// Parse additional subjects if they exist
				let additionalSubjects = [];
				if (speaker.additionalSubjects) {
					try {
						additionalSubjects = JSON.parse(speaker.additionalSubjects);
					} catch (e) {
						console.error('Error parsing additional subjects:', e);
					}
				}

				const content = `
					<div class="row">
						<div class="col-md-6">
							<h6 class="text-primary mb-3">Paper Information</h6>
							<table class="table table-sm">
								<tr><td><strong>Paper Title:</strong></td><td>${speaker.paperTitle || '-'}</td></tr>
								<tr><td><strong>Primary Subject:</strong></td><td>${speaker.primarySubject ? speaker.primarySubject.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) : '-'}</td></tr>
								<tr><td><strong>Keywords:</strong></td><td>${speaker.keywords || '-'}</td></tr>
								<tr><td><strong>Abstract:</strong></td><td>${speaker.paperAbstract ? speaker.paperAbstract.substring(0, 200) + '...' : '-'}</td></tr>
								${additionalSubjects.length > 0 ? `<tr><td><strong>Additional Subjects:</strong></td><td>${additionalSubjects.map(s => s.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())).join(', ')}</td></tr>` : ''}
							</table>
						</div>
						<div class="col-md-6">
							<h6 class="text-primary mb-3">Author Information</h6>
							<table class="table table-sm">
								<tr><td><strong>Name:</strong></td><td>${speaker.name || '-'}</td></tr>
								<tr><td><strong>Email:</strong></td><td><a href="mailto:${speaker.email}">${speaker.email || '-'}</a></td></tr>
								<tr><td><strong>Phone:</strong></td><td>${speaker.phone || '-'}</td></tr>
								<tr><td><strong>Institution:</strong></td><td>${speaker.institutionName || '-'}</td></tr>
								<tr><td><strong>Country:</strong></td><td>${speaker.country || '-'}</td></tr>
								<tr><td><strong>ORCID ID:</strong></td><td>${speaker.orcidId || '-'}</td></tr>
								<tr><td><strong>Corresponding Author:</strong></td><td>${speaker.isCorrespondingAuthor ? 'Yes' : 'No'}</td></tr>
							</table>
						</div>
					</div>

					${coAuthors.length > 0 ? `
					<div class="row mt-3">
						<div class="col-12">
							<h6 class="text-primary mb-3">Co-authors (${coAuthors.length})</h6>
							<div class="table-responsive">
								<table class="table table-sm table-striped">
									<thead>
										<tr>
											<th>Name</th>
											<th>Email</th>
											<th>Institution</th>
											<th>Country</th>
											<th>ORCID</th>
											<th>Corresponding</th>
										</tr>
									</thead>
									<tbody>
										${coAuthors.map(coAuthor => `
											<tr>
												<td>${coAuthor.name || '-'}</td>
												<td><a href="mailto:${coAuthor.email}">${coAuthor.email || '-'}</a></td>
												<td>${coAuthor.institution || '-'}</td>
												<td>${coAuthor.country || '-'}</td>
												<td>${coAuthor.orcidId || '-'}</td>
												<td>${coAuthor.corresponding ? 'Yes' : 'No'}</td>
											</tr>
										`).join('')}
									</tbody>
								</table>
							</div>
						</div>
					</div>
					` : ''}

					<div class="row mt-3">
						<div class="col-md-6">
							<h6 class="text-primary mb-3">Files</h6>
							<table class="table table-sm">
								<tr><td><strong>Paper File:</strong></td><td>${speaker.paperFileUrl ? `<a href="${speaker.paperFileUrl}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="fas fa-file-pdf"></i> View</a>` : 'Not uploaded'}</td></tr>
								<tr><td><strong>Supplementary Files:</strong></td><td>${speaker.supplementaryFileUrl ? `<a href="${speaker.supplementaryFileUrl}" target="_blank" class="btn btn-sm btn-outline-info"><i class="fas fa-file-archive"></i> View</a>` : 'Not uploaded'}</td></tr>
								<tr><td><strong>Source Code:</strong></td><td>${speaker.sourceCodeFileUrl ? `<a href="${speaker.sourceCodeFileUrl}" target="_blank" class="btn btn-sm btn-outline-success"><i class="fas fa-code"></i> View</a>` : 'Not uploaded'}</td></tr>
							</table>
						</div>
						<div class="col-md-6">
							<h6 class="text-primary mb-3">Review Information</h6>
							<table class="table table-sm">
								<tr><td><strong>Status:</strong></td><td>${getReviewStatusBadge(speaker.reviewStatus)}</td></tr>
								<tr><td><strong>Sent to Committee:</strong></td><td>${speaker.sentToCommittee ? 'Yes' : 'No'}</td></tr>
								<tr><td><strong>Submitted:</strong></td><td>${new Date(speaker.createdAt).toLocaleDateString()}</td></tr>
								<tr><td><strong>Last Updated:</strong></td><td>${new Date(speaker.updatedAt).toLocaleDateString()}</td></tr>
							</table>
						</div>
					</div>

					<div class="row mt-3">
						<div class="col-12">
							<h6 class="text-primary mb-3">Additional Information</h6>
							<div class="row">
								<div class="col-md-6">
									<h6 class="text-secondary">Declarations</h6>
									<ul class="list-unstyled">
										<li><i class="fas fa-${speaker.ethicsCompliance ? 'check text-success' : 'times text-danger'}"></i> Ethics Compliance</li>
										<li><i class="fas fa-${speaker.dataAvailability ? 'check text-success' : 'times text-danger'}"></i> Data Availability</li>
										<li><i class="fas fa-${speaker.preprintPolicy ? 'check text-success' : 'times text-danger'}"></i> Preprint Policy ${speaker.preprintUrl ? `(<a href="${speaker.preprintUrl}" target="_blank">View</a>)` : ''}</li>
										<li><i class="fas fa-${speaker.conflictOfInterest ? 'check text-success' : 'times text-danger'}"></i> No Conflict of Interest</li>
									</ul>
								</div>
								<div class="col-md-6">
									<h6 class="text-secondary">Supplementary Questions</h6>
									<ul class="list-unstyled">
										<li><i class="fas fa-${speaker.previouslySubmitted ? 'check text-success' : 'times text-danger'}"></i> Previously Submitted</li>
										<li><i class="fas fa-${speaker.willingToReview ? 'check text-success' : 'times text-danger'}"></i> Willing to Review</li>
										<li><i class="fas fa-${speaker.aiGeneratedContent ? 'check text-success' : 'times text-danger'}"></i> AI-Generated Content</li>
										<li><i class="fas fa-${speaker.studentPaper ? 'check text-success' : 'times text-danger'}"></i> Student Paper</li>
									</ul>
								</div>
							</div>
							${speaker.message ? `<div class="mt-2"><strong>Additional Comments:</strong><br>${speaker.message}</div>` : ''}
						</div>
					</div>
				`;

				document.getElementById('paperSubmissionDetailsContent').innerHTML = content;
				new bootstrap.Modal(document.getElementById('paperSubmissionDetailsModal')).show();
			} catch (error) {
				console.error('Error loading paper submission details:', error);
				alert('Error loading paper submission details: ' + error.message);
			}
		}

		// Show speaker statistics
		async function showSpeakerStats() {
			try {
				const token = localStorage.getItem('adminToken');
				const response = await fetch(`${API_BASE_URL}/admin/speakers/stats`, {
					headers: {
						'Authorization': `Bearer ${token}`
					}
				});

				if (!response.ok) {
					throw new Error('Failed to fetch speaker statistics');
				}

				const result = await response.json();
				const stats = result.stats;

				// Update statistics cards
				document.getElementById('totalPapers').textContent = stats.total || 0;
				document.getElementById('pendingPapers').textContent = stats.pending || 0;
				document.getElementById('underReviewPapers').textContent = stats.underReview || 0;
				document.getElementById('approvedPapers').textContent = stats.approved || 0;
				document.getElementById('rejectedPapers').textContent = stats.rejected || 0;
				document.getElementById('needsRevisionPapers').textContent = stats.needsRevision || 0;

				// Show/hide statistics cards
				const statsCards = document.getElementById('speakerStatsCards');
				if (statsCards.style.display === 'none') {
					statsCards.style.display = 'block';
				} else {
					statsCards.style.display = 'none';
				}
			} catch (error) {
				console.error('Error loading speaker statistics:', error);
				alert('Error loading speaker statistics: ' + error.message);
			}
		}

		// Check authentication on page load
		document.addEventListener('DOMContentLoaded', function() {
			checkAuth();
			loadDashboardData();
			loadCommitteeMembers(); // Load committee members on page load
		});

		function checkAuth() {
			const token = localStorage.getItem('adminToken');
			if (!token) {
				window.location.href = 'index.html';
				return;
			}

			// Verify token and load admin info
			fetch(`${API_BASE_URL}/admin/info`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error('Unauthorized');
				}
				return response.json();
			})
			.then(data => {
				document.getElementById('adminEmail').textContent = data.email;
				document.getElementById('referralCodeDisplay').textContent = `Code: ${data.referralCode}`;
				document.getElementById('referralCodeInput').value = data.referralCode;
				
				// Set up referral links
				const baseUrl = window.location.origin;
				document.getElementById('confReferralLink').value = `${baseUrl}/register.html?ref=${data.referralCode}`;
				document.getElementById('speakerReferralLink').value = `${baseUrl}/paper.html?ref=${data.referralCode}`;
			})
			.catch(error => {
				console.error('Auth error:', error);
				localStorage.removeItem('adminToken');
				window.location.href = 'index.html';
			});
		}

		function logout() {
			localStorage.removeItem('adminToken');
			window.location.href = 'index.html';
		}

		function toggleSidebar() {
			const sidebar = document.getElementById('sidebar');
			const mainContent = document.getElementById('mainContent');
			
			if (window.innerWidth <= 768) {
				sidebar.classList.toggle('show');
			} else {
				sidebar.classList.toggle('collapsed');
				mainContent.classList.toggle('expanded');
			}
		}

		function showSection(sectionName) {
			// Hide all sections
			document.querySelectorAll('.content-section').forEach(section => {
				section.classList.remove('active');
			});
			
			// Remove active class from all nav links
			document.querySelectorAll('.sidebar .nav-link').forEach(link => {
				link.classList.remove('active');
			});
			
			// Show selected section
			document.getElementById(sectionName).classList.add('active');
			
			// Add active class to clicked nav link
			event.target.classList.add('active');

			// Load data for the section
			switch(sectionName) {
				case 'registrations':
					loadRegistrations();
					break;
				case 'speakers':
					loadSpeakers();
					break;
				case 'keynote-speakers':
					loadKeynoteSpeakers();
					break;
				case 'sponsors':
					loadSponsors();
					break;
				case 'referrals':
					loadReferredUsers();
					break;
				case 'contacts':
					loadContacts();
					break;
			}
		}

		function loadDashboardData() {
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/dashboard-stats`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				// console.log('Dashboard data received:', data); // Debug log
				// Update stats (backend now returns direct format)
				document.getElementById('registrationsCount').textContent = data.registrations || 0;
				document.getElementById('speakersCount').textContent = data.speakers || 0;
				document.getElementById('keynoteSpeakersCount').textContent = data.keynoteSpeakers || 0;
				document.getElementById('sponsorsCount').textContent = data.sponsors || 0;
				document.getElementById('adminsCount').textContent = data.admins || 0;
				
				// Update recent registrations table
				const tbody = document.getElementById('recentRegistrationsTable');
				tbody.innerHTML = '';
				
				if (data.recentRegistrations.length === 0) {
					tbody.innerHTML = '<tr><td colspan="4" class="text-center">No recent registrations</td></tr>';
				} else {
					data.recentRegistrations.forEach(reg => {
						tbody.innerHTML += `
							<tr>
								<td>${reg.name}</td>
								<td>${reg.email}</td>
								<td>${new Date(reg.createdAt).toLocaleDateString()}</td>
								<td>${reg.regFee}</td>
							</tr>
						`;
					});
				}
			})
			.catch(error => {
				console.error('Error loading dashboard data:', error);
			});
		}

		function loadRegistrations() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#registrationsTable')) {
				$('#registrationsTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/registrations`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				// Initialize DataTable with responsive configuration
				$('#registrationsTable').DataTable({
					data: data,
					columns: [
						{ 
							data: 'id',
							title: 'ID',
							responsivePriority: 9,
							className: 'd-none d-xl-table-cell',
							width: '60px'
						},
						{ 
							data: 'name',
							title: 'Name',
							responsivePriority: 1,
							render: function(data, type, row) {
								return `<div>
									<div class="fw-bold">${data}</div>
									<small class="text-muted d-md-none">${row.email}</small>
								</div>`;
							}
						},
						{ 
							data: 'email',
							title: 'Email',
							responsivePriority: 3,
							className: 'd-none d-md-table-cell',
							render: function(data) {
								return `<a href="mailto:${data}" class="text-decoration-none">${data}</a>`;
							}
						},
						{ 
							data: 'phone',
							title: 'Phone',
							responsivePriority: 7,
							className: 'd-none d-lg-table-cell',
							render: function(data) {
								return data || '-';
							}
						},
						{ 
							data: 'country',
							title: 'Country',
							responsivePriority: 6,
							className: 'd-none d-lg-table-cell',
							render: function(data) {
								return data || '-';
							}
						},
						{ 
							data: 'institutionName',
							title: 'Institution',
							responsivePriority: 5,
							className: 'd-none d-xl-table-cell',
							render: function(data) {
								return data || '-';
							}
						},
						{ 
							data: 'registrationType',
							title: 'Type',
							responsivePriority: 4,
							className: 'd-none d-lg-table-cell'
						},
						{ 
							data: 'regFee',
							title: 'Fee',
							responsivePriority: 8,
							className: 'd-none d-xl-table-cell',
							render: function(data) {
								return data ? `${data}` : '-';
							}
						},
						{ 
							data: 'isPaid',
							title: 'Status',
							responsivePriority: 2,
							render: function(data) {
								return data ? '<span class="badge bg-success">Paid</span>' : '<span class="badge bg-warning">Pending</span>';
							}
						},
						{
							data: null,
							title: 'Actions',
							responsivePriority: 1,
							className: 'text-center',
							orderable: false,
							render: function(data, type, row) {
								return `
									<div class="btn-group">
										<button class="btn btn-sm btn-primary me-1" onclick="editRecord('registrations', ${row.id})" title="Edit">
											<i class="fas fa-edit"></i>
										</button>
										<button class="btn btn-sm btn-danger" onclick="deleteRecord('registrations', ${row.id})" title="Delete">
											<i class="fas fa-trash"></i>
										</button>
									</div>
								`;
							}
						}
					],
					responsive: {
						details: {
							type: 'column',
							target: 'tr'
						}
					},
					pageLength: 25,
					order: [[0, 'desc']],
					scrollX: true,
					autoWidth: false,
					columnDefs: [
						{ width: "60px", targets: 0 },
						{ width: "150px", targets: 1 },
						{ width: "180px", targets: 2 },
						{ width: "120px", targets: 3 },
						{ width: "100px", targets: 4 },
						{ width: "150px", targets: 5 },
						{ width: "120px", targets: 6 },
						{ width: "100px", targets: 7 },
						{ width: "100px", targets: 8 },
						{ width: "120px", targets: 9 }
					],
					language: {
						emptyTable: "No registrations found",
						info: "Showing _START_ to _END_ of _TOTAL_ registrations",
						infoEmpty: "Showing 0 to 0 of 0 registrations",
						infoFiltered: "(filtered from _MAX_ total registrations)"
					}
				});
			})
			.catch(error => {
				console.error('Error loading registrations:', error);
			});
		}

		function loadSpeakers() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#speakersTable')) {
				$('#speakersTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/speakers`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				// console.log('Raw speakers data:', data);
				currentSpeakers = data.speakers || data; // Store speakers for reference
				// console.log('Processed speakers data:', currentSpeakers);
				
				// Initialize DataTable with responsive configuration
				$('#speakersTable').DataTable({
					data: currentSpeakers,
					columns: [
						{ 
							data: null,
							title: 'Files',
							className: 'text-center',
							responsivePriority: 5,
							render: function(data, type, row) {
								let filesHtml = '';
								if (row.paperFileUrl) {
									filesHtml += `<a href="${row.paperFileUrl}" target="_blank" class="btn btn-sm btn-outline-primary me-1" title="View Paper">
										<i class="fas fa-file-pdf"></i>
									</a>`;
								}
								if (row.supplementaryFileUrl) {
									filesHtml += `<a href="${row.supplementaryFileUrl}" target="_blank" class="btn btn-sm btn-outline-info me-1" title="Supplementary Files">
										<i class="fas fa-file-archive"></i>
									</a>`;
								}
								if (row.sourceCodeFileUrl) {
									filesHtml += `<a href="${row.sourceCodeFileUrl}" target="_blank" class="btn btn-sm btn-outline-success" title="Source Code">
										<i class="fas fa-code"></i>
									</a>`;
								}
								return filesHtml || '<span class="text-muted">-</span>';
							}
						},
						{ 
							data: 'name',
							title: 'Author',
							responsivePriority: 1,
							render: function(data, type, row) {
								return `<div class="d-flex align-items-center">
									<div>
										<div class="fw-bold">${data}</div>
										<small class="text-muted d-md-none">${row.email}</small>
										${row.coAuthors ? `<small class="text-info d-none d-lg-block">+${JSON.parse(row.coAuthors).length} co-authors</small>` : ''}
									</div>
								</div>`;
							}
						},
						{ 
							data: 'email',
							title: 'Email',
							responsivePriority: 4,
							className: 'd-none d-md-table-cell',
							render: function(data) {
								return `<a href="mailto:${data}" class="text-decoration-none">${data}</a>`;
							}
						},
						{ 
							data: 'institutionName',
							title: 'Institution',
							responsivePriority: 6,
							className: 'd-none d-lg-table-cell',
							render: function(data) {
								return data || '-';
							}
						},
						{ 
							data: 'paperTitle',
							title: 'Paper Title',
							responsivePriority: 3,
							render: function(data, type, row) {
								if (data && data.length > 50) {
									return `<span title="${data}">${data.substring(0, 50)}...</span>`;
								}
								return data || '-';
							}
						},
						{ 
							data: 'primarySubject',
							title: 'Subject Area',
							responsivePriority: 6,
							className: 'd-none d-lg-table-cell',
							render: function(data) {
								return data ? data.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) : '-';
							}
						},
						{ 
							data: 'country',
							title: 'Country',
							responsivePriority: 7,
							className: 'd-none d-xl-table-cell',
							render: function(data) {
								return data || '-';
							}
						},
						{ 
							data: 'reviewStatus',
							title: 'Review Status',
							responsivePriority: 2,
							render: function(data, type, row) {
								const statusBadge = getReviewStatusBadge(data);
								const debugInfo = row.sentToCommittee !== undefined ? 
									`<br><small class="text-muted">Sent: ${row.sentToCommittee ? 'Yes' : 'No'}</small>` : 
									`<br><small class="text-danger">sentToCommittee: undefined</small>`;
								return statusBadge + debugInfo;
							}
						},
						{
							data: null,
							title: 'Actions',
							responsivePriority: 1,
							className: 'text-center',
							orderable: false,
							render: function(data, type, row) {
								// Debug logging to check the values
								// console.log('Speaker data:', {
								// 	id: row.id,
								// 	reviewStatus: row.reviewStatus,
								// 	sentToCommittee: row.sentToCommittee
								// });
								
								// Check if speaker can be sent to committee using helper function
								const canSendToCommittee = canSendSpeakerToCommittee(row);
								
								return `
									<div class="btn-group">
										<button class="btn btn-sm btn-info me-1" onclick="showPaperSubmissionDetails('${row.id}')" title="View Details">
											<i class="fas fa-eye"></i>
										</button>
										${canSendToCommittee ? 
											`<button class="btn btn-sm btn-success me-1" onclick="showSendToCommitteeModal('${row.id}')" title="Send to Committee">
												<i class="fas fa-users-cog"></i>
											</button>` : 
											`<button class="btn btn-sm btn-warning me-1" onclick="showUpdateSpeakerStatusModal('${row.id}')" title="Update Status">
												<i class="fas fa-clipboard-check"></i>
											</button>`
										}
										<button class="btn btn-sm btn-danger" onclick="deleteRecord('speakers', '${row.id}')" title="Delete">
											<i class="fas fa-trash"></i>
										</button>
									</div>
								`;
							}
						}
					],
					responsive: {
						details: {
							type: 'column',
							target: 'tr'
						}
					},
					pageLength: 25,
					order: [[0, 'desc']],
					scrollX: true,
					autoWidth: false,
					columnDefs: [
						{ width: "100px", targets: 0 },
						{ width: "150px", targets: 1 },
						{ width: "180px", targets: 2 },
						{ width: "180px", targets: 3 },
						{ width: "250px", targets: 4 },
						{ width: "150px", targets: 5 },
						{ width: "120px", targets: 6 },
						{ width: "130px", targets: 7 },
						{ width: "150px", targets: 8 }
					],
					language: {
						emptyTable: "No paper submissions found",
						info: "Showing _START_ to _END_ of _TOTAL_ submissions",
						infoEmpty: "Showing 0 to 0 of 0 submissions",
						infoFiltered: "(filtered from _MAX_ total submissions)"
					}
				});
			})
			.catch(error => {
				console.error('Error loading speakers:', error);
			});
		}

		function loadKeynoteSpeakers() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#keynoteSpeakersTable')) {
				$('#keynoteSpeakersTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/keynote-speakers`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				// Initialize DataTable with responsive configuration
				$('#keynoteSpeakersTable').DataTable({
					data: data.keynoteSpeakers,
					columns: [
						{ 
							data: 'name',
							title: 'Name',
							responsivePriority: 1,
							render: function(data, type, row) {
								return `<div>
									<div class="fw-bold">${data}</div>
									<small class="text-muted d-md-none">${row.email}</small>
								</div>`;
							}
						},
						{ 
							data: 'email',
							title: 'Email',
							responsivePriority: 3,
							className: 'd-none d-md-table-cell',
							render: function(data) {
								return `<a href="mailto:${data}" class="text-decoration-none">${data}</a>`;
							}
						},
						{ 
							data: 'institutionName',
							title: 'Institution',
							responsivePriority: 5,
							className: 'd-none d-lg-table-cell',
							render: function(data) {
								return data || '-';
							}
						},
						{ 
							data: 'keynoteTitle',
							title: 'Keynote Title',
							responsivePriority: 2,
							render: function(data, type, row) {
								if (data && data.length > 50) {
									return `<span title="${data}">${data.substring(0, 50)}...</span>`;
								}
								return data || '-';
							}
						},
						{ 
							data: 'expertiseArea',
							title: 'Expertise Area',
							responsivePriority: 6,
							className: 'd-none d-xl-table-cell',
							render: function(data) {
								return data || '-';
							}
						},
						{ 
							data: 'status',
							title: 'Status',
							responsivePriority: 4,
							render: function(data, type, row) {
								return getStatusBadge(data);
							}
						},
						{
							data: null,
							title: 'Actions',
							responsivePriority: 1,
							className: 'text-center',
							orderable: false,
							render: function(data, type, row) {
								return `
									<div class="btn-group">
										<button class="btn btn-sm btn-primary me-1" onclick="editRecord('keynote-speakers', '${row.id}')" title="Edit">
											<i class="fas fa-edit"></i>
										</button>
										<button class="btn btn-sm btn-info me-1" onclick="viewKeynoteSpeakerDetails('${row.id}')" title="View Details">
											<i class="fas fa-info-circle"></i>
										</button>
										<button class="btn btn-sm btn-danger" onclick="deleteRecord('keynote-speakers', '${row.id}')" title="Delete">
											<i class="fas fa-trash"></i>
										</button>
									</div>
								`;
							}
						}
					],
					responsive: {
						details: {
							type: 'column',
							target: 'tr'
						}
					},
					pageLength: 25,
					order: [[0, 'asc']], // Sort by name ascending
					scrollX: true,
					autoWidth: false,
					columnDefs: [
						{ width: "150px", targets: 0 },
						{ width: "180px", targets: 1 },
						{ width: "150px", targets: 2 },
						{ width: "200px", targets: 3 },
						{ width: "150px", targets: 4 },
						{ width: "100px", targets: 5 },
						{ width: "120px", targets: 6 }
					],
					language: {
						emptyTable: "No keynote speakers found",
						info: "Showing _START_ to _END_ of _TOTAL_ keynote speakers",
						infoEmpty: "Showing 0 to 0 of 0 keynote speakers",
						infoFiltered: "(filtered from _MAX_ total keynote speakers)"
					}
				});
			})
			.catch(error => {
				console.error('Error loading keynote speakers:', error);
			});
		}

		function getStatusBadge(status) {
			const statusClasses = {
				'PENDING': 'bg-warning',
				'UNDER_REVIEW': 'bg-info',
				'APPROVED': 'bg-success',
				'REJECTED': 'bg-danger',
				'CONFIRMED': 'bg-primary'
			};
			return `<span class="badge ${statusClasses[status] || 'bg-secondary'}">${status}</span>`;
		}

		function loadSponsors() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#sponsorsTable')) {
				$('#sponsorsTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/sponsors`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				const tbody = document.querySelector('#sponsorsTable tbody');
				tbody.innerHTML = '';
				
				data.forEach(sponsor => {
					tbody.innerHTML += `
						<tr>
							<td>${sponsor.id}</td>
							<td>${sponsor.name}</td>
							<td>${sponsor.email}</td>
							<td>${sponsor.level}</td>
							<td>${sponsor.amount}</td>
							<td>${sponsor.isPaid ? '<span class="badge bg-success">Paid</span>' : '<span class="badge bg-warning">Pending</span>'}</td>
							<td>
								<button class="btn btn-sm btn-primary me-1" onclick="editRecord('sponsors', ${sponsor.id})">
									<i class="fas fa-edit"></i>
								</button>
								<button class="btn btn-sm btn-danger" onclick="deleteRecord('sponsors', ${sponsor.id})">
									<i class="fas fa-trash"></i>
								</button>
							</td>
						</tr>
					`;
				});

				// Initialize DataTable
				$('#sponsorsTable').DataTable({
					responsive: true,
					pageLength: 25,
					order: [[0, 'desc']]
				});
			})
			.catch(error => {
				console.error('Error loading sponsors:', error);
			});
		}

		function loadReferredUsers() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#referredUsersTable')) {
				$('#referredUsersTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/referred-users`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				const tbody = document.querySelector('#referredUsersTable tbody');
				tbody.innerHTML = '';
				
				if (data.length === 0) {
					tbody.innerHTML = '<tr><td colspan="3" class="text-center">No referred users yet</td></tr>';
				} else {
					data.forEach(user => {
						tbody.innerHTML += `
							<tr>
								<td>${user.name}</td>
								<td>${user.email}</td>
								<td>${new Date(user.createdAt).toLocaleDateString()}</td>
							</tr>
						`;
					});

					// Initialize DataTable
					$('#referredUsersTable').DataTable({
						responsive: true,
						pageLength: 25,
						order: [[2, 'desc']]
					});
				}
			})
			.catch(error => {
				console.error('Error loading referred users:', error);
			});
		}

		function editRecord(type, id) {
			currentEditType = type;
			currentEditId = id;
			
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/${type}/${id}`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(data => {
				document.getElementById('editModalTitle').textContent = `Edit ${type.slice(0, -1)}`;
				
				let formHTML = '';
				switch(type) {
					case 'registrations':
						formHTML = `
							<form id="editForm">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" name="name" value="${data.name}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" name="email" value="${data.email}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Phone</label>
										<input type="text" class="form-control" name="phone" value="${data.phone}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Country</label>
										<input type="text" class="form-control" name="country" value="${data.country}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Institution</label>
										<input type="text" class="form-control" name="institutionName" value="${data.institutionName}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Registration Type</label>
										<input type="text" class="form-control" name="registrationType" value="${data.registrationType}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Registration Fee</label>
										<input type="text" class="form-control" name="regFee" value="${data.regFee}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Payment Status</label>
										<select class="form-control" name="isPaid">
											<option value="false" ${!data.isPaid ? 'selected' : ''}>Pending</option>
											<option value="true" ${data.isPaid ? 'selected' : ''}>Paid</option>
										</select>
									</div>
								</div>
							</form>
						`;
						break;
					case 'speakers':
						formHTML = `
							<form id="editForm" enctype="multipart/form-data">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" name="name" value="${data.name}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" name="email" value="${data.email}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Phone</label>
										<input type="text" class="form-control" name="phone" value="${data.phone}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Institution</label>
										<input type="text" class="form-control" name="institutionName" value="${data.institutionName}">
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Paper Title</label>
										<input type="text" class="form-control" name="paperTitle" value="${data.paperTitle}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Country</label>
										<input type="text" class="form-control" name="country" value="${data.country}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Attendee Type</label>
										<select class="form-control" name="attendeeType">
											<option value="presenter" ${data.attendeeType === 'presenter' ? 'selected' : ''}>Presenter</option>
											<option value="listener" ${data.attendeeType === 'listener' ? 'selected' : ''}>Listener</option>
										</select>
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Review Status</label>
										<select class="form-control" name="reviewStatus">
											<option value="PENDING" ${data.reviewStatus === 'PENDING' ? 'selected' : ''}>Pending</option>
											<option value="SENT_TO_COMMITTEE" ${data.reviewStatus === 'SENT_TO_COMMITTEE' ? 'selected' : ''}>Sent to Committee</option>
											<option value="UNDER_REVIEW" ${data.reviewStatus === 'UNDER_REVIEW' ? 'selected' : ''}>Under Review</option>
											<option value="APPROVED" ${data.reviewStatus === 'APPROVED' ? 'selected' : ''}>Approved</option>
											<option value="REJECTED" ${data.reviewStatus === 'REJECTED' ? 'selected' : ''}>Rejected</option>
											<option value="NEEDS_REVISION" ${data.reviewStatus === 'NEEDS_REVISION' ? 'selected' : ''}>Needs Revision</option>
										</select>
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Current Paper File</label>
										<div class="mb-2">
											${data.fileUrl ? `<a href="${data.fileUrl}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="fas fa-file-pdf"></i> View Current File</a>` : '<span class="text-muted">No file uploaded</span>'}
										</div>
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Upload New Paper (Optional)</label>
										<input type="file" class="form-control" name="fileInput" accept=".pdf,.docx,.tex,.latex">
										<small class="text-muted">Leave empty to keep current file. Supported formats: PDF, DOCX, LaTeX (.tex, .latex)</small>
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Message</label>
										<textarea class="form-control" name="message" rows="3">${data.message}</textarea>
									</div>
								</div>
							</form>
						`;
						break;
					case 'keynote-speakers':
						formHTML = `
							<form id="editForm">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" name="name" value="${data.name}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" name="email" value="${data.email}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Institution</label>
										<input type="text" class="form-control" name="institutionName" value="${data.institutionName}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Keynote Title</label>
										<input type="text" class="form-control" name="keynoteTitle" value="${data.keynoteTitle}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Expertise Area</label>
										<input type="text" class="form-control" name="expertiseArea" value="${data.expertiseArea}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Status</label>
										<select class="form-control" name="status">
											<option value="PENDING" ${data.status === 'PENDING' ? 'selected' : ''}>Pending Review</option>
											<option value="UNDER_REVIEW" ${data.status === 'UNDER_REVIEW' ? 'selected' : ''}>Under Review</option>
											<option value="APPROVED" ${data.status === 'APPROVED' ? 'selected' : ''}>Approved</option>
											<option value="REJECTED" ${data.status === 'REJECTED' ? 'selected' : ''}>Rejected</option>
											<option value="CONFIRMED" ${data.status === 'CONFIRMED' ? 'selected' : ''}>Confirmed</option>
										</select>
									</div>
								</div>
							</form>
						`;
						break;
					case 'sponsors':
						formHTML = `
							<form id="editForm">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" name="name" value="${data.name}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" name="email" value="${data.email}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Sponsorship Level</label>
										<select class="form-control" name="level">
											<option value="platinum" ${data.level === 'platinum' ? 'selected' : ''}>Platinum</option>
											<option value="gold" ${data.level === 'gold' ? 'selected' : ''}>Gold</option>
											<option value="silver" ${data.level === 'silver' ? 'selected' : ''}>Silver</option>
											<option value="bronze" ${data.level === 'bronze' ? 'selected' : ''}>Bronze</option>
										</select>
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Amount</label>
										<input type="text" class="form-control" name="amount" value="${data.amount}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Payment Status</label>
										<select class="form-control" name="isPaid">
											<option value="false" ${!data.isPaid ? 'selected' : ''}>Pending</option>
											<option value="true" ${data.isPaid ? 'selected' : ''}>Paid</option>
										</select>
									</div>
								</div>
							</form>
						`;
						break;
				}
				
				document.getElementById('editModalBody').innerHTML = formHTML;
				new bootstrap.Modal(document.getElementById('editModal')).show();
			})
			.catch(error => {
				console.error('Error loading record:', error);
				alert('Error loading record details');
			});
		}

		function saveEdit() {
			const form = document.getElementById('editForm');
			const formData = new FormData(form);
			
			const token = localStorage.getItem('adminToken');
			
			// For speakers, we need to send FormData to support file uploads
			// For other types, we can use JSON
			let requestOptions = {
				method: 'PUT',
				headers: {
					'Authorization': `Bearer ${token}`
				}
			};
			
			if (currentEditType === 'speakers') {
				// Use FormData for file uploads
				requestOptions.body = formData;
			} else {
				// Convert FormData to JSON for other types
				const data = {};
				for (let [key, value] of formData.entries()) {
					if (key === 'isPaid') {
						data[key] = value === 'true';
					} else {
						data[key] = value;
					}
				}
				requestOptions.headers['Content-Type'] = 'application/json';
				requestOptions.body = JSON.stringify(data);
			}
			
			fetch(`${API_BASE_URL}/admin/${currentEditType}/${currentEditId}`, requestOptions)
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(result => {
				bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
				alert('Record updated successfully');
				
				// Reload the appropriate section
				switch(currentEditType) {
					case 'registrations':
						loadRegistrations();
						break;
					case 'speakers':
						loadSpeakers();
						break;
					case 'keynote-speakers':
						loadKeynoteSpeakers();
						break;
					case 'sponsors':
						loadSponsors();
						break;
				}
				loadDashboardData(); // Refresh dashboard stats
			})
			.catch(error => {
				console.error('Error updating record:', error);
				alert('Error updating record');
			});
		}

		function deleteRecord(type, id) {
			if (!confirm('Are you sure you want to delete this record? This action cannot be undone.')) {
				return;
			}
			
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/${type}/${id}`, {
				method: 'DELETE',
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(result => {
				alert('Record deleted successfully');
				
				// Reload the appropriate section
				switch(type) {
					case 'registrations':
						loadRegistrations();
						break;
					case 'speakers':
						loadSpeakers();
						break;
					case 'keynote-speakers':
						loadKeynoteSpeakers();
						break;
					case 'sponsors':
						loadSponsors();
						break;
				}
				loadDashboardData(); // Refresh dashboard stats
			})
			.catch(error => {
				console.error('Error deleting record:', error);
				alert('Error deleting record');
			});
		}

		function exportData(type) {
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/${type}`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				// Convert data to CSV
				const csvContent = convertToCSV(data, type);
				downloadCSV(csvContent, `${type}_export_${new Date().toISOString().split('T')[0]}.csv`);
			})
			.catch(error => {
				console.error('Error exporting data:', error);
				alert('Error exporting data');
			});
		}

		function convertToCSV(data, type) {
			if (data.length === 0) return '';
			
			const headers = Object.keys(data[0]);
			const csvRows = [headers.join(',')];
			
			data.forEach(row => {
				const values = headers.map(header => {
					const value = row[header];
					return typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value;
				});
				csvRows.push(values.join(','));
			});
			
			return csvRows.join('\n');
		}

		function downloadCSV(csvContent, filename) {
			const blob = new Blob([csvContent], { type: 'text/csv' });
			const url = window.URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = filename;
			a.click();
			window.URL.revokeObjectURL(url);
		}

		function copyReferralCode() {
			const input = document.getElementById('referralCodeInput');
			input.select();
			document.execCommand('copy');
			
			// Show feedback
			const button = event.target;
			const originalText = button.innerHTML;
			button.innerHTML = '<i class="fas fa-check"></i> Copied!';
			button.classList.add('btn-success');
			button.classList.remove('btn-primary');
			
			setTimeout(() => {
				button.innerHTML = originalText;
				button.classList.remove('btn-success');
				button.classList.add('btn-primary');
			}, 2000);
		}

		function copyLink(inputId) {
			const input = document.getElementById(inputId);
			input.select();
			document.execCommand('copy');
			
			// Show feedback
			const button = event.target;
			const originalText = button.innerHTML;
			button.innerHTML = '<i class="fas fa-check"></i>';
			
			setTimeout(() => {
				button.innerHTML = originalText;
			}, 2000);
		}

		function viewKeynoteSpeakerDetails(speakerId) {
			const token = localStorage.getItem('adminToken');
			fetch(`${API_BASE_URL}/admin/keynote-speakers/${speakerId}`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(result => {
				const speaker = result.keynoteSpeaker;
				const modalContent = document.getElementById('keynoteSpeakerDetailsContent');
				modalContent.dataset.speakerId = speaker.id;
				
				const statusBadge = getStatusBadge(speaker.status);
				
				modalContent.innerHTML = `
					<div class="row">
						<div class="col-md-6">
							<h5><i class="fas fa-user me-2"></i>Personal Information</h5>
							<p><strong>Name:</strong> ${speaker.name}</p>
							<p><strong>Email:</strong> ${speaker.email}</p>
							<p><strong>Phone:</strong> ${speaker.phone}</p>
							<p><strong>Country:</strong> ${speaker.country}</p>
						</div>
						<div class="col-md-6">
							<h5><i class="fas fa-briefcase me-2"></i>Professional Information</h5>
							<p><strong>Designation:</strong> ${speaker.designation}</p>
							<p><strong>Institution:</strong> ${speaker.institutionName}</p>
							<p><strong>Department:</strong> ${speaker.department || 'Not specified'}</p>
							<p><strong>Experience:</strong> ${speaker.experienceYears} years</p>
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-6">
							<h5><i class="fas fa-graduation-cap me-2"></i>Academic Credentials</h5>
							<p><strong>Highest Degree:</strong> ${speaker.highestDegree}</p>
							<p><strong>University:</strong> ${speaker.university || 'Not specified'}</p>
							<p><strong>Publications:</strong> ${speaker.publicationsCount || 'Not specified'}</p>
							<p><strong>Notable Achievements:</strong> ${speaker.notableAchievements || 'Not specified'}</p>
						</div>
						<div class="col-md-6">
							<h5><i class="fas fa-microphone me-2"></i>Speaking Experience</h5>
							<p><strong>Previous Keynotes:</strong> ${speaker.keynoteExperience || 'Not specified'}</p>
							<p><strong>Notable Conferences:</strong> ${speaker.notableConferences || 'Not specified'}</p>
							<p><strong>Expertise Area:</strong> ${speaker.expertiseArea}</p>
							<p><strong>Specialization:</strong> ${speaker.specialization}</p>
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-12">
							<h5><i class="fas fa-lightbulb me-2"></i>Proposed Keynote</h5>
							<p><strong>Title:</strong> ${speaker.keynoteTitle}</p>
							<div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 5px; background-color: #f8f9fa;">
								<strong>Abstract:</strong><br>
								${speaker.keynoteAbstract}
							</div>
							${speaker.targetAudience ? `<p class="mt-2"><strong>Target Audience:</strong> ${speaker.targetAudience}</p>` : ''}
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-6">
							<h5><i class="fas fa-globe me-2"></i>Online Presence</h5>
							${speaker.linkedinProfile ? `<p><strong>LinkedIn:</strong> <a href="${speaker.linkedinProfile}" target="_blank">${speaker.linkedinProfile}</a></p>` : ''}
							${speaker.website ? `<p><strong>Website:</strong> <a href="${speaker.website}" target="_blank">${speaker.website}</a></p>` : ''}
							${speaker.orcidId ? `<p><strong>ORCID:</strong> ${speaker.orcidId}</p>` : ''}
							${speaker.googleScholar ? `<p><strong>Google Scholar:</strong> <a href="${speaker.googleScholar}" target="_blank">View Profile</a></p>` : ''}
						</div>
						<div class="col-md-6">
							<h5><i class="fas fa-info-circle me-2"></i>Additional Information</h5>
							<p><strong>Status:</strong> ${statusBadge}</p>
							<p><strong>Preferred Session:</strong> ${speaker.preferredSessionTime || 'No preference'}</p>
							<p><strong>Accommodation Needed:</strong> ${speaker.accommodationNeeded || 'Not specified'}</p>
							<p><strong>Dietary Restrictions:</strong> ${speaker.dietaryRestrictions || 'None'}</p>
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-12">
							<h5><i class="fas fa-file me-2"></i>Uploaded Files</h5>
							<p><strong>CV/Resume:</strong> ${speaker.cvFileUrl ? '<a href="' + speaker.cvFileUrl + '" target="_blank" class="btn btn-sm btn-outline-primary"><i class="fas fa-download"></i> Download CV</a>' : 'Not uploaded'}</p>
							<p><strong>Photo:</strong> ${speaker.photoFileUrl ? '<a href="' + speaker.photoFileUrl + '" target="_blank" class="btn btn-sm btn-outline-primary"><i class="fas fa-image"></i> View Photo</a>' : 'Not uploaded'}</p>
							<p><strong>Presentation:</strong> ${speaker.presentationFileUrl ? '<a href="' + speaker.presentationFileUrl + '" target="_blank" class="btn btn-sm btn-outline-primary"><i class="fas fa-download"></i> Download Presentation</a>' : 'Not uploaded'}</p>
						</div>
					</div>
					${speaker.additionalComments ? `
					<hr>
					<div class="row">
						<div class="col-12">
							<h5><i class="fas fa-comment me-2"></i>Additional Comments</h5>
							<div style="max-height: 150px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 5px; background-color: #f8f9fa;">
								${speaker.additionalComments}
							</div>
						</div>
					</div>
					` : ''}
					<hr>
					<div class="row">
						<div class="col-12">
							<h5><i class="fas fa-clock me-2"></i>Registration Information</h5>
							<p><strong>Registered:</strong> ${new Date(speaker.createdAt).toLocaleDateString()} at ${new Date(speaker.createdAt).toLocaleTimeString()}</p>
							<p><strong>Last Updated:</strong> ${new Date(speaker.updatedAt).toLocaleDateString()} at ${new Date(speaker.updatedAt).toLocaleTimeString()}</p>
							${speaker.referredBy ? `<p><strong>Referred by Admin:</strong> ${speaker.referredBy.email}</p>` : ''}
						</div>
					</div>
				`;
				new bootstrap.Modal(document.getElementById('keynoteSpeakerDetailsModal')).show();
			})
			.catch(error => {
				console.error('Error loading keynote speaker details:', error);
				alert('Error loading keynote speaker details: ' + error.message);
			});
		}

		function showStatusUpdateModal() {
			const speakerId = document.getElementById('keynoteSpeakerDetailsContent').dataset.speakerId;
			document.getElementById('statusUpdateSpeakerId').value = speakerId;
			new bootstrap.Modal(document.getElementById('statusUpdateModal')).show();
		}

		function updateKeynoteSpeakerStatus() {
			const speakerId = document.getElementById('statusUpdateSpeakerId').value;
			const newStatus = document.getElementById('newStatus').value;
			const statusNotes = document.getElementById('statusNotes').value;

			const token = localStorage.getItem('adminToken');

			fetch(`${API_BASE_URL}/admin/keynote-speakers/${speakerId}/status`, {
				method: 'PUT',
				headers: {
					'Authorization': `Bearer ${token}`,
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ status: newStatus, notes: statusNotes })
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(data => {
				alert('Keynote speaker status updated successfully!');
				loadKeynoteSpeakers(); // Reload the table to show updated status
				new bootstrap.Modal(document.getElementById('statusUpdateModal')).hide();
			})
			.catch(error => {
				console.error('Error updating keynote speaker status:', error);
				alert('Error updating keynote speaker status');
			});
		}

		// Handle responsive behavior
		window.addEventListener('resize', function() {
			if (window.innerWidth > 768) {
				document.getElementById('sidebar').classList.remove('show');
			}
		});

		// Contact Management Functions
		function loadContacts() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#contactsTable')) {
				$('#contactsTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/contact`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				// Initialize DataTable with responsive configuration
				$('#contactsTable').DataTable({
					data: data,
					columns: [
						{ 
							data: 'name',
							title: 'Name',
							responsivePriority: 1
						},
						{ 
							data: 'email',
							title: 'Email',
							responsivePriority: 2,
							render: function(data) {
								return `<a href="mailto:${data}" class="text-decoration-none">${data}</a>`;
							}
						},
						{ 
							data: 'phone',
							title: 'Phone',
							responsivePriority: 3,
							render: function(data) {
								return `<a href="tel:${data}" class="text-decoration-none">${data}</a>`;
							}
						},
						{ 
							data: 'subject',
							title: 'Subject',
							responsivePriority: 4,
							render: function(data) {
								if (data && data.length > 50) {
									return `<span title="${data}">${data.substring(0, 50)}...</span>`;
								}
								return data || '-';
							}
						},
						{ 
							data: 'message',
							title: 'Message',
							responsivePriority: 5,
							className: 'text-wrap',
							render: function(data) {
								if (data && data.length > 100) {
									return `<span title="${data}">${data.substring(0, 100)}...</span>`;
								}
								return data || '-';
							}
						},
						{ 
							data: 'createdAt',
							title: 'Date',
							responsivePriority: 6,
							render: function(data) {
								return new Date(data).toLocaleDateString();
							}
						},
						{
							data: null,
							title: 'Actions',
							responsivePriority: 1,
							className: 'text-center',
							orderable: false,
							render: function(data, type, row) {
								return `
									<div class="btn-group">
										<button class="btn btn-sm btn-info me-1" onclick="viewContactDetails('${row.id}')" title="View Details">
											<i class="fas fa-eye"></i>
										</button>
										<button class="btn btn-sm btn-danger" onclick="deleteContact('${row.id}')" title="Delete">
											<i class="fas fa-trash"></i>
										</button>
									</div>
								`;
							}
						}
					],
					responsive: {
						details: {
							type: 'column',
							target: 'tr'
						}
					},
					pageLength: 25,
					order: [[5, 'desc']], // Sort by date (newest first)
					scrollX: true,
					autoWidth: false,
					columnDefs: [
						{ width: "120px", targets: 0 },
						{ width: "180px", targets: 1 },
						{ width: "120px", targets: 2 },
						{ width: "200px", targets: 3 },
						{ width: "300px", targets: 4 },
						{ width: "120px", targets: 5 },
						{ width: "100px", targets: 6 }
					],
					dom: 'Bfrtip',
					buttons: [
						{
							extend: 'csv',
							text: '<i class="fas fa-download"></i> CSV',
							className: 'btn btn-success btn-sm'
						}
					],
					language: {
						emptyTable: "No contact queries found",
						info: "Showing _START_ to _END_ of _TOTAL_ queries",
						infoEmpty: "Showing 0 to 0 of 0 queries",
						infoFiltered: "(filtered from _MAX_ total queries)"
					}
				});
			})
			.catch(error => {
				console.error('Error loading contacts:', error);
				alert('Error loading contacts: ' + error.message);
			});
		}

		function viewContactDetails(contactId) {
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/contact`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(contacts => {
				const contact = contacts.find(c => c.id === contactId);
				if (!contact) {
					alert('Contact not found');
					return;
				}

				const content = `
					<div class="row">
						<div class="col-md-6">
							<h6 class="text-primary mb-3">Contact Information</h6>
							<table class="table table-sm">
								<tr><td><strong>Name:</strong></td><td>${contact.name}</td></tr>
								<tr><td><strong>Email:</strong></td><td><a href="mailto:${contact.email}">${contact.email}</a></td></tr>
								<tr><td><strong>Phone:</strong></td><td><a href="tel:${contact.phone}">${contact.phone}</a></td></tr>
								<tr><td><strong>Subject:</strong></td><td>${contact.subject}</td></tr>
								<tr><td><strong>Date:</strong></td><td>${new Date(contact.createdAt).toLocaleString()}</td></tr>
							</table>
						</div>
						<div class="col-md-6">
							<h6 class="text-primary mb-3">Message</h6>
							<div class="border rounded p-3 bg-light">
								${contact.message.replace(/\n/g, '<br>')}
							</div>
						</div>
					</div>
				`;

				// Create a modal to show contact details
				const modal = document.createElement('div');
				modal.className = 'modal fade';
				modal.id = 'contactDetailsModal';
				modal.innerHTML = `
					<div class="modal-dialog modal-lg">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title"><i class="fas fa-envelope me-2"></i>Contact Query Details</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
							</div>
							<div class="modal-body">
								${content}
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				`;

				document.body.appendChild(modal);
				const bootstrapModal = new bootstrap.Modal(modal);
				bootstrapModal.show();

				// Remove modal from DOM after it's hidden
				modal.addEventListener('hidden.bs.modal', () => {
					document.body.removeChild(modal);
				});
			})
			.catch(error => {
				console.error('Error loading contact details:', error);
				alert('Error loading contact details: ' + error.message);
			});
		}

		function deleteContact(contactId) {
			if (!confirm('Are you sure you want to delete this contact query? This action cannot be undone.')) return;

			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/contact/${contactId}`, {
				method: 'DELETE',
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(data => {
				alert('Contact query deleted successfully!');
				loadContacts(); // Reload the table
			})
			.catch(error => {
				console.error('Error deleting contact query:', error);
				alert('Error deleting contact query: ' + error.message);
			});
		}
	</script>
</body>

</html>