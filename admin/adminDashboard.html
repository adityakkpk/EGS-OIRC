<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Admin Dashboard | ICMMCS 2025</title>
	<meta name="description" content="Admin dashboard for managing the ICMMCS 2025 conference.">
	<meta property="og:image" content="../assets/img/sponsors_logo/3.png" />
	<meta property="og:title" content="Admin Dashboard | ICMMCS 2025" />
	<meta property="og:description" content="Admin dashboard for managing the ICMMCS 2025 conference." />
	<meta property="og:url" content="https://www.icmmcs.org/admin/adminDashboard.html" />

	<!--=====FAB ICON=======-->
	<link rel="shortcut icon" href="../assets/img/sponsors_logo/favicon.png" />

	<!--===== CSS LINK =======-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">

	<style>
		body {
			background-color: #f8f9fa;
		}

		.sidebar {
			min-height: 100vh;
			background: linear-gradient(180deg, #019087 0%, #006666 100%);
			color: white;
			position: fixed;
			top: 0;
			left: 0;
			width: 250px;
			z-index: 1000;
			transition: all 0.3s;
		}

		.sidebar.collapsed {
			margin-left: -250px;
		}

		.main-content {
			margin-left: 250px;
			transition: all 0.3s;
		}

		.main-content.expanded {
			margin-left: 0;
		}

		.navbar {
			background-color: white;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.sidebar .nav-link {
			color: rgba(255,255,255,0.8);
			border-radius: 5px;
			margin: 2px 0;
		}

		.sidebar .nav-link:hover, .sidebar .nav-link.active {
			background-color: rgba(255,255,255,0.1);
			color: white;
		}

		.card {
			border: none;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
			border-radius: 10px;
		}

		.stats-card {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border-radius: 15px;
		}

		.stats-card.registrations {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		}

		.stats-card.speakers {
			background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
		}

		.stats-card.sponsors {
			background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
		}

		.stats-card.admins {
			background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
		}

		.table thead th {
			background-color: #019087;
			color: white;
			border: none;
		}

		.btn-primary {
			background-color: #019087;
			border-color: #019087;
		}

		.btn-primary:hover {
			background-color: #006666;
			border-color: #006666;
		}

		.content-section {
			display: none;
		}

		.content-section.active {
			display: block;
		}

		.sidebar-brand {
			padding: 1rem;
			text-align: center;
			border-bottom: 1px solid rgba(255,255,255,0.2);
		}

		.toggle-btn {
			position: fixed;
			top: 10px;
			left: 10px;
			z-index: 1001;
		}

		@media (max-width: 768px) {
			.sidebar {
				margin-left: -250px;
			}
			.main-content {
				margin-left: 0;
			}
			.sidebar.show {
				margin-left: 0;
			}
		}

		.modal-backdrop {
			z-index: 1040;
		}

		.modal {
			z-index: 1050;
		}
	</style>
</head>

<body>
	<!-- Toggle Button -->
	<button class="btn btn-primary toggle-btn d-md-none" onclick="toggleSidebar()">
		<i class="fas fa-bars"></i>
	</button>

	<!-- Sidebar -->
	<nav class="sidebar" id="sidebar">
		<div class="sidebar-brand">
			<h4>ICMMCS Admin</h4>
			<p class="mb-0">Dashboard</p>
		</div>
		<ul class="nav flex-column p-3">
			<li class="nav-item">
				<a class="nav-link active" href="#" onclick="showSection('dashboard')">
					<i class="fas fa-tachometer-alt me-2"></i> Dashboard
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('registrations')">
					<i class="fas fa-users me-2"></i> Registrations
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('speakers')">
					<i class="fas fa-microphone me-2"></i> Speakers
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('sponsors')">
					<i class="fas fa-handshake me-2"></i> Sponsors
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onclick="showSection('referrals')">
					<i class="fas fa-link me-2"></i> My Referrals
				</a>
			</li>
			<li class="nav-item mt-3">
				<a class="nav-link text-warning" href="#" onclick="logout()">
					<i class="fas fa-sign-out-alt me-2"></i> Logout
				</a>
			</li>
		</ul>
	</nav>

	<!-- Main Content -->
	<div class="main-content" id="mainContent">
		<!-- Top Navbar -->
		<nav class="navbar navbar-expand-lg">
			<div class="container-fluid">
				<button class="btn btn-outline-primary d-none d-md-block" onclick="toggleSidebar()">
					<i class="fas fa-bars"></i>
				</button>
				<span class="navbar-text ms-3">
					Welcome, <span id="adminEmail">Admin</span>
				</span>
				<div class="ms-auto">
					<span class="badge bg-primary me-2" id="referralCodeDisplay">Loading...</span>
				</div>
			</div>
		</nav>

		<!-- Dashboard Content -->
		<div class="container-fluid p-4">
			<!-- Dashboard Section -->
			<div id="dashboard" class="content-section active">
				<h2 class="mb-4">Dashboard Overview</h2>
				
				<!-- Stats Cards -->
				<div class="row mb-4">
					<div class="col-md-3 mb-3">
						<div class="card stats-card registrations">
							<div class="card-body text-center">
								<i class="fas fa-users fa-2x mb-2"></i>
								<h3 id="registrationsCount">0</h3>
								<p class="mb-0">Total Registrations</p>
							</div>
						</div>
					</div>
					<div class="col-md-3 mb-3">
						<div class="card stats-card speakers">
							<div class="card-body text-center">
								<i class="fas fa-microphone fa-2x mb-2"></i>
								<h3 id="speakersCount">0</h3>
								<p class="mb-0">Total Speakers</p>
							</div>
						</div>
					</div>
					<div class="col-md-3 mb-3">
						<div class="card stats-card sponsors">
							<div class="card-body text-center">
								<i class="fas fa-handshake fa-2x mb-2"></i>
								<h3 id="sponsorsCount">0</h3>
								<p class="mb-0">Total Sponsors</p>
							</div>
						</div>
					</div>
					<div class="col-md-3 mb-3">
						<div class="card stats-card admins">
							<div class="card-body text-center">
								<i class="fas fa-user-shield fa-2x mb-2"></i>
								<h3 id="adminsCount">0</h3>
								<p class="mb-0">Total Admins</p>
							</div>
						</div>
					</div>
				</div>

				<!-- Recent Registrations -->
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">Recent Registrations</h5>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-hover">
								<thead>
									<tr>
										<th>Name</th>
										<th>Email</th>
										<th>Registration Date</th>
										<th>Fee</th>
									</tr>
								</thead>
								<tbody id="recentRegistrationsTable">
									<tr>
										<td colspan="4" class="text-center">Loading...</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Registrations Section -->
			<div id="registrations" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Conference Registrations</h2>
					<button class="btn btn-success" onclick="exportData('registrations')">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="registrationsTable" class="table table-striped table-hover">
								<thead>
									<tr>
										<th>ID</th>
										<th>Name</th>
										<th>Email</th>
										<th>Phone</th>
										<th>Country</th>
										<th>Institution</th>
										<th>Type</th>
										<th>Fee</th>
										<th>Paid</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Speakers Section -->
			<div id="speakers" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Conference Speakers</h2>
					<button class="btn btn-success" onclick="exportData('speakers')">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="speakersTable" class="table table-striped table-hover">
								<thead>
									<tr>
										<th>Paper</th>
										<th>Name</th>
										<th>Email</th>
										<th>Phone</th>
										<th>Institution</th>
										<th>Paper Title</th>
										<th>Country</th>
										<th>Type</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Sponsors Section -->
			<div id="sponsors" class="content-section">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>Conference Sponsors</h2>
					<button class="btn btn-success" onclick="exportData('sponsors')">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="sponsorsTable" class="table table-striped table-hover">
								<thead>
									<tr>
										<th>ID</th>
										<th>Name</th>
										<th>Email</th>
										<th>Level</th>
										<th>Amount</th>
										<th>Paid</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Referrals Section -->
			<div id="referrals" class="content-section">
				<h2 class="mb-4">My Referrals</h2>
				<div class="row mb-4">
					<div class="col-md-6">
						<div class="card">
							<div class="card-header">
								<h5 class="mb-0">Your Referral Code</h5>
							</div>
							<div class="card-body">
								<div class="input-group">
									<input type="text" class="form-control" id="referralCodeInput" readonly>
									<button class="btn btn-primary" onclick="copyReferralCode()">
										<i class="fas fa-copy"></i> Copy
									</button>
								</div>
								<small class="text-muted">Share this code with potential registrants</small>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card">
							<div class="card-header">
								<h5 class="mb-0">Referral Links</h5>
							</div>
							<div class="card-body">
								<div class="mb-2">
									<label class="form-label">Conference Registration:</label>
									<div class="input-group input-group-sm">
										<input type="text" class="form-control" id="confReferralLink" readonly>
										<button class="btn btn-outline-primary btn-sm" onclick="copyLink('confReferralLink')">
											<i class="fas fa-copy"></i>
										</button>
									</div>
								</div>
								<div>
									<label class="form-label">Speaker Registration:</label>
									<div class="input-group input-group-sm">
										<input type="text" class="form-control" id="speakerReferralLink" readonly>
										<button class="btn btn-outline-primary btn-sm" onclick="copyLink('speakerReferralLink')">
											<i class="fas fa-copy"></i>
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">Referred Users</h5>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table id="referredUsersTable" class="table table-striped">
								<thead>
									<tr>
										<th>Name</th>
										<th>Email</th>
										<th>Registration Date</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Edit Modal -->
	<div class="modal fade" id="editModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="editModalTitle">Edit Record</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" id="editModalBody">
					<!-- Dynamic content will be loaded here -->
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

	<script>
		let currentEditId = null;
		let currentEditType = null;
		const API_BASE_URL = 'https://egs-conference-backend.onrender.com/api';
		// const API_BASE_URL = 'http://localhost:5000/api';

		// Check authentication on page load
		document.addEventListener('DOMContentLoaded', function() {
			checkAuth();
			loadDashboardData();
		});

		function checkAuth() {
			const token = localStorage.getItem('adminToken');
			if (!token) {
				window.location.href = 'index.html';
				return;
			}

			// Verify token and load admin info
			fetch(`${API_BASE_URL}/admin/info`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error('Unauthorized');
				}
				return response.json();
			})
			.then(data => {
				document.getElementById('adminEmail').textContent = data.email;
				document.getElementById('referralCodeDisplay').textContent = `Code: ${data.referralCode}`;
				document.getElementById('referralCodeInput').value = data.referralCode;
				
				// Set up referral links
				const baseUrl = window.location.origin;
				document.getElementById('confReferralLink').value = `${baseUrl}/register.html?ref=${data.referralCode}`;
				document.getElementById('speakerReferralLink').value = `${baseUrl}/speaker-register.html?ref=${data.referralCode}`;
			})
			.catch(error => {
				console.error('Auth error:', error);
				localStorage.removeItem('adminToken');
				window.location.href = 'index.html';
			});
		}

		function logout() {
			localStorage.removeItem('adminToken');
			window.location.href = 'index.html';
		}

		function toggleSidebar() {
			const sidebar = document.getElementById('sidebar');
			const mainContent = document.getElementById('mainContent');
			
			if (window.innerWidth <= 768) {
				sidebar.classList.toggle('show');
			} else {
				sidebar.classList.toggle('collapsed');
				mainContent.classList.toggle('expanded');
			}
		}

		function showSection(sectionName) {
			// Hide all sections
			document.querySelectorAll('.content-section').forEach(section => {
				section.classList.remove('active');
			});
			
			// Remove active class from all nav links
			document.querySelectorAll('.sidebar .nav-link').forEach(link => {
				link.classList.remove('active');
			});
			
			// Show selected section
			document.getElementById(sectionName).classList.add('active');
			
			// Add active class to clicked nav link
			event.target.classList.add('active');

			// Load data for the section
			switch(sectionName) {
				case 'registrations':
					loadRegistrations();
					break;
				case 'speakers':
					loadSpeakers();
					break;
				case 'sponsors':
					loadSponsors();
					break;
				case 'referrals':
					loadReferredUsers();
					break;
			}
		}

		function loadDashboardData() {
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/dashboard-stats`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				console.log('Dashboard data received:', data); // Debug log
				// Update stats (backend now returns direct format)
				document.getElementById('registrationsCount').textContent = data.registrations || 0;
				document.getElementById('speakersCount').textContent = data.speakers || 0;
				document.getElementById('sponsorsCount').textContent = data.sponsors || 0;
				document.getElementById('adminsCount').textContent = data.admins || 0;
				
				// Update recent registrations table
				const tbody = document.getElementById('recentRegistrationsTable');
				tbody.innerHTML = '';
				
				if (data.recentRegistrations.length === 0) {
					tbody.innerHTML = '<tr><td colspan="4" class="text-center">No recent registrations</td></tr>';
				} else {
					data.recentRegistrations.forEach(reg => {
						tbody.innerHTML += `
							<tr>
								<td>${reg.name}</td>
								<td>${reg.email}</td>
								<td>${new Date(reg.createdAt).toLocaleDateString()}</td>
								<td>${reg.regFee}</td>
							</tr>
						`;
					});
				}
			})
			.catch(error => {
				console.error('Error loading dashboard data:', error);
			});
		}

		function loadRegistrations() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#registrationsTable')) {
				$('#registrationsTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/registrations`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				const tbody = document.querySelector('#registrationsTable tbody');
				tbody.innerHTML = '';
				
				data.forEach(reg => {
					tbody.innerHTML += `
						<tr>
							<td>${reg.id}</td>
							<td>${reg.name}</td>
							<td>${reg.email}</td>
							<td>${reg.phone}</td>
							<td>${reg.country}</td>
							<td>${reg.institutionName}</td>
							<td>${reg.registrationType}</td>
							<td>${reg.regFee}</td>
							<td>${reg.isPaid ? '<span class="badge bg-success">Paid</span>' : '<span class="badge bg-warning">Pending</span>'}</td>
							<td>
								<button class="btn btn-sm btn-primary me-1" onclick="editRecord('registrations', ${reg.id})">
									<i class="fas fa-edit"></i>
								</button>
								<button class="btn btn-sm btn-danger" onclick="deleteRecord('registrations', ${reg.id})">
									<i class="fas fa-trash"></i>
								</button>
							</td>
						</tr>
					`;
				});

				// Initialize DataTable
				$('#registrationsTable').DataTable({
					responsive: true,
					pageLength: 25,
					order: [[0, 'desc']]
				});
			})
			.catch(error => {
				console.error('Error loading registrations:', error);
			});
		}

		function loadSpeakers() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#speakersTable')) {
				$('#speakersTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/speakers`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				const tbody = document.querySelector('#speakersTable tbody');
				tbody.innerHTML = '';
				
				data.forEach(speaker => {
					tbody.innerHTML += `
						<tr>
							<td>${speaker.fileUrl}</td>
							<td>${speaker.name}</td>
							<td>${speaker.email}</td>
							<td>${speaker.phone}</td>
							<td>${speaker.institutionName}</td>
							<td>${speaker.paperTitle}</td>
							<td>${speaker.country}</td>
							<td>${speaker.attendeeType}</td>
							<td>
								<button class="btn btn-sm btn-primary me-1" onclick="editRecord('speakers', '${speaker.id}')">
									<i class="fas fa-edit"></i>
								</button>
								<button class="btn btn-sm btn-danger" onclick="deleteRecord('speakers', '${speaker.id}')">
									<i class="fas fa-trash"></i>
								</button>
							</td>
						</tr>
					`;
				});

				// Initialize DataTable
				$('#speakersTable').DataTable({
					responsive: true,
					pageLength: 25,
					order: [[0, 'desc']]
				});
			})
			.catch(error => {
				console.error('Error loading speakers:', error);
			});
		}

		function loadSponsors() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#sponsorsTable')) {
				$('#sponsorsTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/sponsors`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				const tbody = document.querySelector('#sponsorsTable tbody');
				tbody.innerHTML = '';
				
				data.forEach(sponsor => {
					tbody.innerHTML += `
						<tr>
							<td>${sponsor.id}</td>
							<td>${sponsor.name}</td>
							<td>${sponsor.email}</td>
							<td>${sponsor.level}</td>
							<td>${sponsor.amount}</td>
							<td>${sponsor.isPaid ? '<span class="badge bg-success">Paid</span>' : '<span class="badge bg-warning">Pending</span>'}</td>
							<td>
								<button class="btn btn-sm btn-primary me-1" onclick="editRecord('sponsors', ${sponsor.id})">
									<i class="fas fa-edit"></i>
								</button>
								<button class="btn btn-sm btn-danger" onclick="deleteRecord('sponsors', ${sponsor.id})">
									<i class="fas fa-trash"></i>
								</button>
							</td>
						</tr>
					`;
				});

				// Initialize DataTable
				$('#sponsorsTable').DataTable({
					responsive: true,
					pageLength: 25,
					order: [[0, 'desc']]
				});
			})
			.catch(error => {
				console.error('Error loading sponsors:', error);
			});
		}

		function loadReferredUsers() {
			const token = localStorage.getItem('adminToken');
			
			// Destroy existing DataTable if it exists
			if ($.fn.DataTable.isDataTable('#referredUsersTable')) {
				$('#referredUsersTable').DataTable().destroy();
			}

			fetch(`${API_BASE_URL}/admin/referred-users`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				const tbody = document.querySelector('#referredUsersTable tbody');
				tbody.innerHTML = '';
				
				if (data.length === 0) {
					tbody.innerHTML = '<tr><td colspan="3" class="text-center">No referred users yet</td></tr>';
				} else {
					data.forEach(user => {
						tbody.innerHTML += `
							<tr>
								<td>${user.name}</td>
								<td>${user.email}</td>
								<td>${new Date(user.createdAt).toLocaleDateString()}</td>
							</tr>
						`;
					});

					// Initialize DataTable
					$('#referredUsersTable').DataTable({
						responsive: true,
						pageLength: 25,
						order: [[2, 'desc']]
					});
				}
			})
			.catch(error => {
				console.error('Error loading referred users:', error);
			});
		}

		function editRecord(type, id) {
			currentEditType = type;
			currentEditId = id;
			
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/${type}/${id}`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(data => {
				document.getElementById('editModalTitle').textContent = `Edit ${type.slice(0, -1)}`;
				
				let formHTML = '';
				switch(type) {
					case 'registrations':
						formHTML = `
							<form id="editForm">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" name="name" value="${data.name}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" name="email" value="${data.email}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Phone</label>
										<input type="text" class="form-control" name="phone" value="${data.phone}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Country</label>
										<input type="text" class="form-control" name="country" value="${data.country}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Institution</label>
										<input type="text" class="form-control" name="institutionName" value="${data.institutionName}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Registration Type</label>
										<input type="text" class="form-control" name="registrationType" value="${data.registrationType}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Registration Fee</label>
										<input type="text" class="form-control" name="regFee" value="${data.regFee}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Payment Status</label>
										<select class="form-control" name="isPaid">
											<option value="false" ${!data.isPaid ? 'selected' : ''}>Pending</option>
											<option value="true" ${data.isPaid ? 'selected' : ''}>Paid</option>
										</select>
									</div>
								</div>
							</form>
						`;
						break;
					case 'speakers':
						formHTML = `
							<form id="editForm" enctype="multipart/form-data">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" name="name" value="${data.name}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" name="email" value="${data.email}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Phone</label>
										<input type="text" class="form-control" name="phone" value="${data.phone}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Institution</label>
										<input type="text" class="form-control" name="institutionName" value="${data.institutionName}">
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Paper Title</label>
										<input type="text" class="form-control" name="paperTitle" value="${data.paperTitle}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Country</label>
										<input type="text" class="form-control" name="country" value="${data.country}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Attendee Type</label>
										<select class="form-control" name="attendeeType">
											<option value="presenter" ${data.attendeeType === 'presenter' ? 'selected' : ''}>Presenter</option>
											<option value="listener" ${data.attendeeType === 'listener' ? 'selected' : ''}>Listener</option>
										</select>
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Current Paper File</label>
										<div class="mb-2">
											${data.fileUrl ? `<a href="${data.fileUrl}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="fas fa-file-pdf"></i> View Current File</a>` : '<span class="text-muted">No file uploaded</span>'}
										</div>
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Upload New Paper (Optional)</label>
										<input type="file" class="form-control" name="fileInput" accept=".pdf,.doc,.docx">
										<small class="text-muted">Leave empty to keep current file. Supported formats: PDF, DOC, DOCX</small>
									</div>
									<div class="col-12 mb-3">
										<label class="form-label">Message</label>
										<textarea class="form-control" name="message" rows="3">${data.message}</textarea>
									</div>
								</div>
							</form>
						`;
						break;
					case 'sponsors':
						formHTML = `
							<form id="editForm">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" name="name" value="${data.name}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" name="email" value="${data.email}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Sponsorship Level</label>
										<select class="form-control" name="level">
											<option value="platinum" ${data.level === 'platinum' ? 'selected' : ''}>Platinum</option>
											<option value="gold" ${data.level === 'gold' ? 'selected' : ''}>Gold</option>
											<option value="silver" ${data.level === 'silver' ? 'selected' : ''}>Silver</option>
											<option value="bronze" ${data.level === 'bronze' ? 'selected' : ''}>Bronze</option>
										</select>
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Amount</label>
										<input type="text" class="form-control" name="amount" value="${data.amount}">
									</div>
									<div class="col-md-6 mb-3">
										<label class="form-label">Payment Status</label>
										<select class="form-control" name="isPaid">
											<option value="false" ${!data.isPaid ? 'selected' : ''}>Pending</option>
											<option value="true" ${data.isPaid ? 'selected' : ''}>Paid</option>
										</select>
									</div>
								</div>
							</form>
						`;
						break;
				}
				
				document.getElementById('editModalBody').innerHTML = formHTML;
				new bootstrap.Modal(document.getElementById('editModal')).show();
			})
			.catch(error => {
				console.error('Error loading record:', error);
				alert('Error loading record details');
			});
		}

		function saveEdit() {
			const form = document.getElementById('editForm');
			const formData = new FormData(form);
			
			const token = localStorage.getItem('adminToken');
			
			// For speakers, we need to send FormData to support file uploads
			// For other types, we can use JSON
			let requestOptions = {
				method: 'PUT',
				headers: {
					'Authorization': `Bearer ${token}`
				}
			};
			
			if (currentEditType === 'speakers') {
				// Use FormData for file uploads
				requestOptions.body = formData;
			} else {
				// Convert FormData to JSON for other types
				const data = {};
				for (let [key, value] of formData.entries()) {
					if (key === 'isPaid') {
						data[key] = value === 'true';
					} else {
						data[key] = value;
					}
				}
				requestOptions.headers['Content-Type'] = 'application/json';
				requestOptions.body = JSON.stringify(data);
			}
			
			fetch(`${API_BASE_URL}/admin/${currentEditType}/${currentEditId}`, requestOptions)
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(result => {
				bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
				alert('Record updated successfully');
				
				// Reload the appropriate section
				switch(currentEditType) {
					case 'registrations':
						loadRegistrations();
						break;
					case 'speakers':
						loadSpeakers();
						break;
					case 'sponsors':
						loadSponsors();
						break;
				}
				loadDashboardData(); // Refresh dashboard stats
			})
			.catch(error => {
				console.error('Error updating record:', error);
				alert('Error updating record');
			});
		}

		function deleteRecord(type, id) {
			if (!confirm('Are you sure you want to delete this record? This action cannot be undone.')) {
				return;
			}
			
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/${type}/${id}`, {
				method: 'DELETE',
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => {
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				return response.json();
			})
			.then(result => {
				alert('Record deleted successfully');
				
				// Reload the appropriate section
				switch(type) {
					case 'registrations':
						loadRegistrations();
						break;
					case 'speakers':
						loadSpeakers();
						break;
					case 'sponsors':
						loadSponsors();
						break;
				}
				loadDashboardData(); // Refresh dashboard stats
			})
			.catch(error => {
				console.error('Error deleting record:', error);
				alert('Error deleting record');
			});
		}

		function exportData(type) {
			const token = localStorage.getItem('adminToken');
			
			fetch(`${API_BASE_URL}/admin/${type}`, {
				headers: {
					'Authorization': `Bearer ${token}`
				}
			})
			.then(response => response.json())
			.then(data => {
				// Convert data to CSV
				const csvContent = convertToCSV(data, type);
				downloadCSV(csvContent, `${type}_export_${new Date().toISOString().split('T')[0]}.csv`);
			})
			.catch(error => {
				console.error('Error exporting data:', error);
				alert('Error exporting data');
			});
		}

		function convertToCSV(data, type) {
			if (data.length === 0) return '';
			
			const headers = Object.keys(data[0]);
			const csvRows = [headers.join(',')];
			
			data.forEach(row => {
				const values = headers.map(header => {
					const value = row[header];
					return typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value;
				});
				csvRows.push(values.join(','));
			});
			
			return csvRows.join('\n');
		}

		function downloadCSV(csvContent, filename) {
			const blob = new Blob([csvContent], { type: 'text/csv' });
			const url = window.URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = filename;
			a.click();
			window.URL.revokeObjectURL(url);
		}

		function copyReferralCode() {
			const input = document.getElementById('referralCodeInput');
			input.select();
			document.execCommand('copy');
			
			// Show feedback
			const button = event.target;
			const originalText = button.innerHTML;
			button.innerHTML = '<i class="fas fa-check"></i> Copied!';
			button.classList.add('btn-success');
			button.classList.remove('btn-primary');
			
			setTimeout(() => {
				button.innerHTML = originalText;
				button.classList.remove('btn-success');
				button.classList.add('btn-primary');
			}, 2000);
		}

		function copyLink(inputId) {
			const input = document.getElementById(inputId);
			input.select();
			document.execCommand('copy');
			
			// Show feedback
			const button = event.target;
			const originalText = button.innerHTML;
			button.innerHTML = '<i class="fas fa-check"></i>';
			
			setTimeout(() => {
				button.innerHTML = originalText;
			}, 2000);
		}

		// Handle responsive behavior
		window.addEventListener('resize', function() {
			if (window.innerWidth > 768) {
				document.getElementById('sidebar').classList.remove('show');
			}
		});
	</script>
</body>

</html>